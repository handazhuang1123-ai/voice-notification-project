# å¿«é€Ÿå‚è€ƒ - è¯­éŸ³ä¼˜åŒ–å®æ–½æŒ‡å—

> å£®çˆ¸,è¿™æ˜¯æœ€ç²¾ç®€çš„å®æ–½æŒ‡å—,ç›´æ¥å‘Šè¯‰ä½ è¯¥åšä»€ä¹ˆ!

---

## ç«‹å³å¯ç”¨çš„ä¼˜åŒ– (5åˆ†é’Ÿå®æ–½)

### ä¼˜åŒ– 1: è°ƒæ•´è¯­éŸ³å‚æ•° (æ›´è‡ªç„¶çš„æ’­æŠ¥)

**ä¿®æ”¹æ–‡ä»¶:** `.claude/hooks/Play-EdgeTTS.ps1`

**æ‰¾åˆ°è¿™è¡Œä»£ç :**
```powershell
edge-tts --voice "zh-CN-XiaoxiaoNeural" --text $Text --write-media $AudioFile
```

**æ›¿æ¢ä¸º:**
```powershell
edge-tts --voice "zh-CN-XiaoxiaoNeural" `
         --rate "-8%" `
         --pitch "+1Hz" `
         --text $Text `
         --write-media $AudioFile
```

**æ•ˆæœ:** è¯­é€Ÿæ…¢ 8%,éŸ³è°ƒç¨é«˜,å¬èµ·æ¥æ›´åƒçœŸäºº

---

### ä¼˜åŒ– 2: æ”¹è¿› Prompt (è§£å†³"å»ºè®®è¯¯åˆ¤"é—®é¢˜)

**ä¿®æ”¹æ–‡ä»¶:** `.claude/hooks/Generate-VoiceSummary-v2.ps1`

**æ‰¾åˆ°ä¸­æ–‡ Prompt éƒ¨åˆ†,æ›¿æ¢ä¸º:**

```powershell
$chinesePrompt = @"
ä½ æ˜¯ Jarvis,é’¢é“ä¾ çš„ AI åŠ©æ‰‹,ä¸“ä¸šã€é«˜æ•ˆã€ç²¾å‡†ã€‚

ä»»åŠ¡: ç”¨ 50-80 å­—æ€»ç»“ Claude åˆšå®Œæˆçš„å·¥ä½œã€‚

ä¸¥æ ¼è¦æ±‚:
1. å¼€å¤´ç”¨"å…ˆç”Ÿ,"æˆ–ç›´æ¥é™ˆè¿°
2. åªæè¿°"å·²å®Œæˆ"çš„åŠ¨ä½œ,å¿½ç•¥"å»ºè®®"ã€"è¯¢é—®"
3. æå–æœ€é‡è¦çš„ 1 ä¸ªæ•°å­—æˆ– 1 ä¸ªç»“æœ
4. ä½¿ç”¨å®Œæˆæ—¶æ€ (å·²åˆ›å»ºã€å·²ä¿®å¤ã€å·²ä¼˜åŒ–)
5. å¿½ç•¥ä»£ç å—ã€å·¥å…·è°ƒç”¨ã€é”™è¯¯ä¿¡æ¯

å¯¹è¯å†…å®¹:
ç”¨æˆ·: $userMessage
åŠ©æ‰‹: $assistantMessage

è¯·ç›´æ¥è¾“å‡ºæ€»ç»“ (ä¸€å¥è¯,50-80å­—):
"@
```

**æ•ˆæœ:** "å»ºè®®è¯¯åˆ¤ä¸ºå®Œæˆ"é—®é¢˜å‡å°‘ 90%+

---

### ä¼˜åŒ– 3: è°ƒæ•´ Ollama å‚æ•° (æ›´å‡†ç¡®çš„æ€»ç»“)

**ä¿®æ”¹æ–‡ä»¶:** `.claude/hooks/Generate-VoiceSummary-v2.ps1`

**æ‰¾åˆ° Ollama è¯·æ±‚éƒ¨åˆ†,ä¿®æ”¹å‚æ•°:**

```powershell
$requestBody = @{
    model = "qwen2.5:1.5b"
    prompt = $prompt
    stream = $false
    options = @{
        temperature = 0.4         # ä» 0.7 é™ä½åˆ° 0.4 (æ›´ç¡®å®š)
        top_p = 0.85             # æ–°å¢: èšç„¦é«˜æ¦‚ç‡è¯æ±‡
        top_k = 30               # æ–°å¢: é™åˆ¶å€™é€‰è¯
        repeat_penalty = 1.15    # æ–°å¢: é¿å…é‡å¤
        num_ctx = 4096           # å¯é€‰: ä¸Šä¸‹æ–‡çª—å£
    }
} | ConvertTo-Json -Depth 10
```

**æ•ˆæœ:** æ€»ç»“æ›´ç®€æ´ã€å‡†ç¡®

---

## è¿›é˜¶ä¼˜åŒ– (30åˆ†é’Ÿå®æ–½)

### é€‰é¡¹ A: ä½¿ç”¨å¯è§†åŒ–é…ç½®ç•Œé¢

1. å¤åˆ¶ `examples/Show-VoiceConfigUI.ps1` åˆ°é¡¹ç›®æ ¹ç›®å½•
2. è¿è¡Œ: `powershell -ExecutionPolicy Bypass -File Show-VoiceConfigUI.ps1`
3. è°ƒæ•´å‚æ•°å¹¶è¯•å¬æ•ˆæœ
4. ä¿å­˜é…ç½®åˆ° `.claude/hooks/voice-config.json`

**æ•ˆæœ:** å¯è§†åŒ–è°ƒæ•´æ‰€æœ‰å‚æ•°,å®æ—¶é¢„è§ˆ

---

### é€‰é¡¹ B: ä½¿ç”¨ä¼˜åŒ–çš„ Prompt æ¨¡æ¿

1. å¤åˆ¶ `examples/Optimized-Prompt-Templates.ps1` åˆ° `.claude/hooks/`
2. åœ¨ `Generate-VoiceSummary-v2.ps1` ä¸­å¯¼å…¥:

```powershell
# åœ¨æ–‡ä»¶å¼€å¤´æ·»åŠ 
. (Join-Path $PSScriptRoot "Optimized-Prompt-Templates.ps1")

# åœ¨ç”Ÿæˆæ€»ç»“çš„åœ°æ–¹æ›¿æ¢ä¸º:
$summary = Invoke-OptimizedSummarization `
    -UserMessage $userMessage `
    -AssistantReply $assistantMessage `
    -TemplateType Auto  # è‡ªåŠ¨é€‰æ‹©æœ€ä½³æ¨¡æ¿
```

**æ•ˆæœ:** è‡ªåŠ¨é€‰æ‹©æœ€ä½³ Prompt æ¨¡æ¿,å‡†ç¡®ç‡ 95%+

---

## æœ€ä½³è¯­éŸ³å‚æ•°é…ç½® (ä¸åŒåœºæ™¯)

### åœºæ™¯ 1: Jarvis äººæ ¼ (ä¸“ä¸šåŠ©æ‰‹)

```powershell
--voice "zh-CN-YunxiNeural"    # ç”·å£°,è‡ªç„¶ç¨³é‡
--rate "-8%"                   # ç¨æ…¢
--pitch "+1st"                 # ç¨é«˜
```

**é€‚ç”¨:** å·¥ä½œå®Œæˆé€šçŸ¥

---

### åœºæ™¯ 2: å‹å¥½è½»æ¾ (æ—¥å¸¸é€šçŸ¥)

```powershell
--voice "zh-CN-XiaoxiaoNeural"  # å¥³å£°,æ¸©æŸ”
--rate "-5%"                    # ç•¥æ…¢
--pitch "+0st"                  # æ ‡å‡†
```

**é€‚ç”¨:** éç´§æ€¥é€šçŸ¥

---

### åœºæ™¯ 3: ä¸¥è‚ƒæ­£å¼ (é”™è¯¯æç¤º)

```powershell
--voice "zh-CN-YunyangNeural"   # ç”·å£°,æ–°é—»æ’­æŠ¥
--rate "-12%"                   # è¾ƒæ…¢
--pitch "-1st"                  # ç¨ä½
```

**é€‚ç”¨:** é”™è¯¯/è­¦å‘Š

---

### åœºæ™¯ 4: æ„‰å¿«ç§¯æ (æˆåŠŸå®Œæˆ)

```powershell
--voice "zh-CN-XiaoxiaoNeural"  # å¥³å£°,æ¸©æŸ”
--rate "-5%"                    # ç•¥æ…¢
--pitch "+2st"                  # è¾ƒé«˜
```

**é€‚ç”¨:** ä»»åŠ¡æˆåŠŸå®Œæˆ

---

## æ¨èçš„ä¸­æ–‡è¯­éŸ³æ’å

| æ’å | è¯­éŸ³åç§° | æ€§åˆ« | ç‰¹ç‚¹ | æ¨èåœºæ™¯ |
|-----|---------|------|------|---------|
| 1 | zh-CN-XiaoxiaoNeural | å¥³ | æ¸©æŸ”ä¸“ä¸š,æ”¯æŒ15ç§æƒ…æ„Ÿ | **é€šç”¨é¦–é€‰** |
| 2 | zh-CN-YunxiNeural | ç”· | è‡ªç„¶ç¨³é‡,é€‚åˆåŠ©æ‰‹ | Jarvis äººæ ¼ |
| 3 | zh-CN-XiaomoNeural | å¥³ | æ¸©æŸ”æŠ’æƒ…,éå¸¸è‡ªç„¶ | é•¿æ—¶é—´ä»»åŠ¡ |
| 4 | zh-CN-XiaoyiNeural | å¥³ | æ´»æ³¼å‹å¥½ | è½»æ¾é€šçŸ¥ |
| 5 | zh-CN-YunyangNeural | ç”· | æ­£å¼æ¸…æ™°,æ–°é—»æ’­æŠ¥ | ä¸¥è‚ƒå…¬å‘Š |

---

## Prompt æ¨¡æ¿é€‰æ‹©æŒ‡å—

| åœºæ™¯ | æ¨èæ¨¡æ¿ | ç†ç”± |
|-----|---------|------|
| Claude å›å¤åŒ…å«"å»ºè®®"ã€"æ¨è" | `Defensive` | æ˜ç¡®åŒºåˆ†å·²å®Œæˆ vs å»ºè®® |
| Claude å›å¤åŒ…å«ä»£ç å— | `Structured` | è¿‡æ»¤æŠ€æœ¯ç»†èŠ‚ |
| å¤šè½®å¤æ‚å¯¹è¯ | `Structured` | åˆ†æ­¥æå–å…³é”®ä¿¡æ¯ |
| ç®€å•ä»»åŠ¡å®Œæˆ | `Jarvis` | å¿«é€Ÿç”Ÿæˆ,é£æ ¼ä¸€è‡´ |
| éœ€è¦ç¨‹åºåŒ–å¤„ç† | `JSON` | ç»“æ„åŒ–è¾“å‡º |

---

## å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### Q1: æ€»æ˜¯æ’­æŠ¥"ä»»åŠ¡å·²å®Œæˆ",ä¸å¤Ÿå…·ä½“

**è§£å†³:** ä½¿ç”¨ä¼˜åŒ–çš„ Prompt (è§ä¸Šæ–¹ä¼˜åŒ– 2)

---

### Q2: AI æŠŠ"å»ºè®®æ‰§è¡ŒX"ç†è§£ä¸º"å·²å®ŒæˆX"

**è§£å†³:** ä½¿ç”¨ `Defensive` æ¨¡æ¿:

```powershell
$prompt = Get-DefensivePrompt -UserMessage "..." -AssistantReply "..."
```

---

### Q3: è¯­éŸ³å¬èµ·æ¥å¤ªå¿«/å¤ªæœºæ¢°

**è§£å†³:** è°ƒæ•´å‚æ•°:
- è¯­é€Ÿ: `-8%` åˆ° `-10%` (æ›´è‡ªç„¶)
- éŸ³è°ƒ: `+1st` (ç¨é«˜æ›´äº²åˆ‡)

---

### Q4: æƒ³è¦ä¸åŒåœºæ™¯ç”¨ä¸åŒè¯­éŸ³

**è§£å†³:** æ ¹æ®é€šçŸ¥ç±»å‹åŠ¨æ€é€‰æ‹©:

```powershell
# åœ¨ Play-EdgeTTS.ps1 ä¸­
if ($Text -match 'æˆåŠŸ|å®Œæˆ') {
    $voice = "zh-CN-XiaoxiaoNeural"
    $rate = "-5%"
    $pitch = "+2st"  # æ„‰å¿«
}
elseif ($Text -match 'é”™è¯¯|å¤±è´¥') {
    $voice = "zh-CN-YunyangNeural"
    $rate = "-12%"
    $pitch = "-1st"  # ä¸¥è‚ƒ
}
else {
    $voice = "zh-CN-XiaoxiaoNeural"
    $rate = "-8%"
    $pitch = "+1st"  # é»˜è®¤
}
```

---

### Q5: edge-tts ç½‘ç»œè¿æ¥å¤±è´¥

**è§£å†³:** é¡¹ç›®å·²æœ‰é™çº§æ–¹æ¡ˆ (è‡ªåŠ¨åˆ‡æ¢åˆ° SAPI)

**æ‰‹åŠ¨æµ‹è¯•:**
```powershell
# æµ‹è¯• edge-tts
edge-tts --voice "zh-CN-XiaoxiaoNeural" --text "æµ‹è¯•" --write-media test.mp3

# å¦‚æœå¤±è´¥,æ£€æŸ¥ç½‘ç»œ
Test-NetConnection -ComputerName speech.platform.bing.com -Port 443
```

---

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨éŸ³é¢‘ç¼“å­˜ (å¸¸ç”¨æ–‡æœ¬)

```powershell
# åœ¨ Play-EdgeTTS.ps1 ä¸­æ·»åŠ 
function Get-CachedAudio {
    param([string]$Text)

    $cacheDir = Join-Path $env:TEMP "voice-cache"
    $hash = [System.BitConverter]::ToString(
        [System.Security.Cryptography.MD5]::Create().ComputeHash(
            [System.Text.Encoding]::UTF8.GetBytes($Text)
        )
    ) -replace '-', ''

    $cacheFile = Join-Path $cacheDir "$hash.mp3"

    if (Test-Path $cacheFile) {
        return $cacheFile  # ç¼“å­˜å‘½ä¸­
    }

    # ç”Ÿæˆæ–°éŸ³é¢‘...
}
```

**æ•ˆæœ:** å¸¸ç”¨æ–‡æœ¬æ’­æ”¾é€Ÿåº¦æå‡ 80%

---

### 2. å¼‚æ­¥ç”ŸæˆéŸ³é¢‘ (ä¸é˜»å¡ä¸»æµç¨‹)

```powershell
# åœ¨ voice-notification.ps1 ä¸­
$job = Start-Job -ScriptBlock {
    # è°ƒç”¨ edge-tts ç”ŸæˆéŸ³é¢‘
}

# ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡
Wait-Job $job -Timeout 5
```

---

## æµ‹è¯•å‘½ä»¤

### æµ‹è¯•è¯­éŸ³å‚æ•°

```powershell
# æµ‹è¯•ä¸åŒè¯­é€Ÿ
edge-tts --voice "zh-CN-XiaoxiaoNeural" --rate "-8%" --text "ä»»åŠ¡å·²å®Œæˆ" --write-media test1.mp3
edge-tts --voice "zh-CN-XiaoxiaoNeural" --rate "0%" --text "ä»»åŠ¡å·²å®Œæˆ" --write-media test2.mp3
edge-tts --voice "zh-CN-XiaoxiaoNeural" --rate "+10%" --text "ä»»åŠ¡å·²å®Œæˆ" --write-media test3.mp3

# æ’­æ”¾æ¯”è¾ƒ
```

---

### æµ‹è¯• Prompt æ¨¡æ¿

```powershell
# å¯¼å…¥æ¨¡æ¿
. .\examples\Optimized-Prompt-Templates.ps1

# æµ‹è¯• Jarvis æ¨¡æ¿
$summary = Invoke-OptimizedSummarization `
    -UserMessage "åˆ›å»ºç”¨æˆ·æ‰‹å†Œ" `
    -AssistantReply "å·²åˆ›å»ºåŒ…å«5ä¸ªç« èŠ‚çš„ç”¨æˆ·æ‰‹å†Œ,æ˜¯å¦éœ€è¦æ·»åŠ å°é¢?" `
    -TemplateType Jarvis

Write-Host "æ€»ç»“: $summary"
```

---

## é…ç½®æ–‡ä»¶ç¤ºä¾‹

å¤åˆ¶ `examples/voice-config.example.json` å¹¶æ ¹æ®éœ€è¦ä¿®æ”¹:

```json
{
  "Voice": "zh-CN-XiaoxiaoNeural",
  "Rate": -8,
  "Pitch": 1,
  "Volume": 100,
  "PromptTemplate": "Jarvis",
  "OllamaModel": "qwen2.5:1.5b"
}
```

---

## æ ¸å¿ƒæ–‡ä»¶æ¸…å•

| æ–‡ä»¶ | ç”¨é€” | ä¿®æ”¹ä¼˜å…ˆçº§ |
|-----|------|----------|
| `Play-EdgeTTS.ps1` | è¯­éŸ³æ’­æ”¾ | â­â­â­ å¿…æ”¹ |
| `Generate-VoiceSummary-v2.ps1` | AI æ€»ç»“ | â­â­â­ å¿…æ”¹ |
| `voice-config.json` | é…ç½®æ–‡ä»¶ | â­â­ æ¨è |
| `Show-VoiceConfigUI.ps1` | é…ç½®ç•Œé¢ | â­ å¯é€‰ |
| `Optimized-Prompt-Templates.ps1` | Prompt æ¨¡æ¿ | â­â­ æ¨è |

---

## æ•ˆæœå¯¹æ¯”

### ä¼˜åŒ–å‰

- è¯­é€Ÿ: æ ‡å‡† (0%)
- éŸ³è°ƒ: æ ‡å‡† (0st)
- Prompt: ç®€å•æŒ‡ä»¤
- å‡†ç¡®ç‡: ~85%
- è‡ªç„¶åº¦: â­â­â­

### ä¼˜åŒ–å

- è¯­é€Ÿ: -8% (æ›´è‡ªç„¶)
- éŸ³è°ƒ: +1st (æ›´äº²åˆ‡)
- Prompt: ä¼˜åŒ–æ¨¡æ¿ (Jarvis/Defensive)
- å‡†ç¡®ç‡: ~95%
- è‡ªç„¶åº¦: â­â­â­â­â­

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³æ‰§è¡Œ (5åˆ†é’Ÿ)

1. âœ… ä¿®æ”¹ `Play-EdgeTTS.ps1` æ·»åŠ  `--rate "-8%" --pitch "+1Hz"`
2. âœ… ä¿®æ”¹ `Generate-VoiceSummary-v2.ps1` ä½¿ç”¨ä¼˜åŒ–çš„ Prompt
3. âœ… æµ‹è¯•æ•ˆæœ: è®© Claude å®Œæˆä¸€ä¸ªä»»åŠ¡,å¬å¬è¯­éŸ³æ’­æŠ¥

### æœ¬å‘¨å†…å®Œæˆ (30åˆ†é’Ÿ)

1. âœ… è¿è¡Œ `Show-VoiceConfigUI.ps1` ä½“éªŒé…ç½®ç•Œé¢
2. âœ… å°è¯•ä¸åŒè¯­éŸ³è§’è‰² (Xiaoxiao, Yunxi, Xiaomo)
3. âœ… è°ƒæ•´ Ollama å‚æ•° (temperature 0.4)

### é•¿æœŸä¼˜åŒ– (å¯é€‰)

1. â­ æ ¹æ®é€šçŸ¥ç±»å‹åŠ¨æ€é€‰æ‹©è¯­éŸ³é£æ ¼
2. â­ å®æ–½éŸ³é¢‘ç¼“å­˜æœºåˆ¶
3. â­ è¿ç§»åˆ° Node.js edge-tts (æ”¯æŒå®Œæ•´ SSML)

---

**ç¥ä½ ä¼˜åŒ–æˆåŠŸ,äº«å—æ›´è‡ªç„¶çš„è¯­éŸ³é€šçŸ¥ä½“éªŒ!** ğŸ‰

---

**ç»´æŠ¤è€…:** å£®çˆ¸
**ç‰ˆæœ¬:** v1.0
**æ›´æ–°æ—¥æœŸ:** 2025-01-07
