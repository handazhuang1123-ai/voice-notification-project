# ä¸ªäººç”»åƒæ¨¡å‹å¿«é€Ÿå¼€å§‹æŒ‡å—

æœ¬æŒ‡å—å¸®åŠ©ä½ åœ¨ 5 åˆ†é’Ÿå†…å®Œæˆæ¨¡å‹é€‰å‹éªŒè¯ã€‚

---

## ç¬¬ä¸€æ­¥ï¼šå®‰è£… Ollamaï¼ˆå¦‚æœæœªå®‰è£…ï¼‰

### Windows
```powershell
# ä¸‹è½½å®‰è£…å™¨
# è®¿é—® https://ollama.com/download
# ä¸‹è½½ Windows ç‰ˆæœ¬å¹¶å®‰è£…

# éªŒè¯å®‰è£…
ollama --version
```

### Linux/Mac
```bash
curl -fsSL https://ollama.com/install.sh | sh
ollama --version
```

---

## ç¬¬äºŒæ­¥ï¼šä¸‹è½½æ¨èæ¨¡å‹

### æ–¹æ¡ˆ Aï¼šå¿«é€ŸéªŒè¯ï¼ˆä»…ä¸‹è½½é¦–é€‰æ¨¡å‹ï¼‰

```bash
# ä¸‹è½½ Qwen2.5-7B-Instructï¼ˆQ5_K_M é‡åŒ–ç‰ˆæœ¬ï¼‰
ollama pull qwen2.5:7b-instruct-q5_K_M
```

**ä¸‹è½½å¤§å°**: ~6.5 GB
**é¢„è®¡æ—¶é—´**: 5-15 åˆ†é’Ÿï¼ˆå–å†³äºç½‘é€Ÿï¼‰

### æ–¹æ¡ˆ Bï¼šå®Œæ•´å¯¹æ¯”ï¼ˆä¸‹è½½å¤šä¸ªæ¨¡å‹ï¼‰

```bash
# 1. é¦–é€‰æ¨¡å‹
ollama pull qwen2.5:7b-instruct-q5_K_M

# 2. æ¨ç†å¢å¼ºæ¨¡å‹
ollama pull deepseek-r1:7b

# 3. æƒ…æ„Ÿå¢å¼ºæ¨¡å‹ï¼ˆå¯é€‰ï¼‰
ollama pull vortex/helpingai-9b
```

**ä¸‹è½½å¤§å°**: ~18 GB
**é¢„è®¡æ—¶é—´**: 15-45 åˆ†é’Ÿ

---

## ç¬¬ä¸‰æ­¥ï¼šå¿«é€Ÿæµ‹è¯•

### æ–¹å¼ 1ï¼šå‘½ä»¤è¡Œäº¤äº’æµ‹è¯•ï¼ˆæœ€ç®€å•ï¼‰

```bash
# å¯åŠ¨äº¤äº’å¼ä¼šè¯
ollama run qwen2.5:7b-instruct-q5_K_M
```

**æµ‹è¯•æç¤ºè¯**ï¼ˆç²˜è´´è¿›å»ï¼‰:
```
ä½ æ˜¯ä¸€ä½è®¿è°ˆè€…ã€‚ç”¨æˆ·è¯´ï¼š"æˆ‘è§‰å¾—æˆ‘æœ€çœ‹é‡çš„æ˜¯è‡ªç”±ï¼Œä¸æƒ³è¢«å·¥ä½œæŸç¼šã€‚"

è¯·æå‡ºä¸€ä¸ªæ·±å…¥çš„è¿½é—®ï¼ˆè‹æ ¼æ‹‰åº•å¼æé—®ï¼‰ï¼Œä»¥ JSON æ ¼å¼è¾“å‡ºï¼š
{
  "question": "ä½ çš„è¿½é—®",
  "reasoning": "ä¸ºä»€ä¹ˆæå‡ºè¿™ä¸ªé—®é¢˜"
}
```

**æœŸæœ›ç»“æœ**:
- åº”è¾“å‡ºæœ‰æ•ˆçš„ JSON
- é—®é¢˜åº”è¯¥æ˜¯å¼€æ”¾æ€§çš„
- å±•ç°ä¸€å®šçš„å…±æƒ…èƒ½åŠ›

**é€€å‡ºä¼šè¯**: è¾“å…¥ `/bye`

---

### æ–¹å¼ 2ï¼šè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# ç¡®ä¿å·²å®‰è£… Node.js ä¾èµ–
npm install

# è¿è¡Œæµ‹è¯•è„šæœ¬
node tests/test-model-selection.js
```

**æµ‹è¯•å†…å®¹**:
1. æ·±åº¦è¿½é—®ç”Ÿæˆèƒ½åŠ›
2. æ´å¯Ÿæå–èƒ½åŠ›
3. JSON ç»“æ„åŒ–è¾“å‡ºç¨³å®šæ€§

**è¾“å‡º**:
- æ¯ä¸ªæ¨¡å‹çš„è¯¦ç»†æµ‹è¯•æŠ¥å‘Š
- å“åº”é€Ÿåº¦ï¼ˆtokens/sï¼‰
- JSON æ ¼å¼æœ‰æ•ˆæ€§
- ä¿å­˜åˆ° `test-results/` ç›®å½•

---

## ç¬¬å››æ­¥ï¼šè¯„ä¼°æ¨¡å‹è´¨é‡

### æ‰‹åŠ¨è¯„åˆ†è¡¨

é’ˆå¯¹æµ‹è¯•è¾“å‡ºï¼Œä½¿ç”¨ä»¥ä¸‹æ ‡å‡†æ‰“åˆ†ï¼ˆ1-5 åˆ†ï¼‰:

| è¯„ä¼°ç»´åº¦ | è¯„åˆ†æ ‡å‡† |
|---------|---------|
| **é—®é¢˜æ·±åº¦** | 1=ç®€å•æ˜¯éé¢˜ï¼Œ5=è§¦åŠæ ¸å¿ƒåŠ¨æœº |
| **å…±æƒ…åº¦** | 1=å†°å†·æœºæ¢°ï¼Œ5=æ¸©æš–ç†è§£ |
| **è‡ªç„¶åº¦** | 1=ç”Ÿç¡¬ä¸é€šé¡ºï¼Œ5=æµç•…è‡ªç„¶ |
| **JSON ç¨³å®šæ€§** | 1=æ— æ•ˆ JSONï¼Œ5=å®Œç¾æ ¼å¼ |
| **æ¨ç†æ¸…æ™°åº¦** | 1=é€»è¾‘æ··ä¹±ï¼Œ5=æ¡ç†æ¸…æ™° |

**ç¤ºä¾‹è¯„åˆ†**:

```
æ¨¡å‹: qwen2.5:7b-instruct-q5_K_M
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âœ¨ æ·±åº¦è¿½é—®æµ‹è¯•
   é—®é¢˜æ·±åº¦: â­â­â­â­â­ (5/5)
   å…±æƒ…åº¦:   â­â­â­â­   (4/5)
   è‡ªç„¶åº¦:   â­â­â­â­â­ (5/5)
   JSONç¨³å®š: â­â­â­â­â­ (5/5)
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
æ€»åˆ†: 19/20

æ¨èåº¦: â­â­â­â­â­
```

---

## ç¬¬äº”æ­¥ï¼šåšå‡ºé€‰æ‹©

### å†³ç­–æ ‘

```
ä½ çš„å†…å­˜å¤§å°ï¼Ÿ
â”œâ”€ 8 GB  â†’ Qwen2.5-7B (Q4_K_M)
â”œâ”€ 16 GB â†’ Qwen2.5-7B (Q5_K_M) â† æ¨è
â””â”€ 32 GB â†’ Qwen2.5-14B (Q5_K_M) æˆ–åŒæ¨¡å‹ç»„åˆ

ä½ çš„ä¼˜å…ˆçº§ï¼Ÿ
â”œâ”€ é€Ÿåº¦ä¼˜å…ˆ     â†’ Qwen2.5-7B (Q4_K_M)
â”œâ”€ è´¨é‡ä¼˜å…ˆ     â†’ Qwen2.5-7B (Q8_0) æˆ– 14B
â”œâ”€ æ¨ç†ä¼˜å…ˆ     â†’ DeepSeek-R1-7B
â””â”€ å…±æƒ…ä¼˜å…ˆ     â†’ HelpingAI-9B

ä½ çš„ä½¿ç”¨åœºæ™¯ï¼Ÿ
â”œâ”€ å®æ—¶å¯¹è¯     â†’ Qwen2.5-7B
â”œâ”€ ç¦»çº¿æ·±åº¦åˆ†æ â†’ DeepSeek-R1-7B
â””â”€ å¿ƒç†å’¨è¯¢å‘   â†’ HelpingAI-9B + Qwen2.5-7B ç»„åˆ
```

---

## ç¬¬å…­æ­¥ï¼šé›†æˆåˆ°é¡¹ç›®

### æ–¹æ³• 1ï¼šä½¿ç”¨ Ollama REST API

```javascript
// ç®€å•ç¤ºä¾‹
const response = await fetch('http://localhost:11434/api/chat', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
        model: 'qwen2.5:7b-instruct-q5_K_M',
        messages: [
            {
                role: 'system',
                content: 'ä½ æ˜¯ä¸€ä½è®¿è°ˆè€…ï¼Œæ“…é•¿è‹æ ¼æ‹‰åº•å¼æé—®ã€‚'
            },
            {
                role: 'user',
                content: userAnswer
            }
        ],
        stream: false
    })
});

const data = await response.json();
const aiResponse = data.message.content;
```

### æ–¹æ³• 2ï¼šä½¿ç”¨ Ollama Node.js SDK

```javascript
import ollama from 'ollama';

const response = await ollama.chat({
    model: 'qwen2.5:7b-instruct-q5_K_M',
    messages: [
        {
            role: 'system',
            content: 'ä½ æ˜¯ä¸€ä½è®¿è°ˆè€…ï¼Œæ“…é•¿è‹æ ¼æ‹‰åº•å¼æé—®ã€‚'
        },
        {
            role: 'user',
            content: userAnswer
        }
    ],
    options: {
        temperature: 0.7,
        num_ctx: 8192,  // ä¸Šä¸‹æ–‡çª—å£
    }
});

console.log(response.message.content);
```

---

## å¸¸è§é—®é¢˜ FAQ

### Q1: æ¨¡å‹ä¸‹è½½é€Ÿåº¦å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ

**A**:
```bash
# æ–¹æ³• 1: ä½¿ç”¨å›½å†…é•œåƒï¼ˆå¦‚æœå¯ç”¨ï¼‰
export OLLAMA_HOST=https://your-mirror.com

# æ–¹æ³• 2: æ–­ç‚¹ç»­ä¼ 
# Ollama æ”¯æŒæ–­ç‚¹ç»­ä¼ ï¼Œå¦‚æœä¸­æ–­å¯ä»¥é‡æ–°è¿è¡Œ pull å‘½ä»¤

# æ–¹æ³• 3: ä¸‹è½½æ›´å°çš„é‡åŒ–ç‰ˆæœ¬
ollama pull qwen2.5:7b-instruct-q4_K_M  # ä»… 4.7 GB
```

---

### Q2: è¿è¡Œæ—¶æç¤ºå†…å­˜ä¸è¶³ï¼Ÿ

**A**:
```bash
# æ£€æŸ¥å¯ç”¨å†…å­˜
# Windows:
wmic OS get FreePhysicalMemory

# Linux/Mac:
free -h

# è§£å†³æ–¹æ¡ˆï¼š
# 1. ä½¿ç”¨æ›´å°çš„é‡åŒ–ç‰ˆæœ¬ï¼ˆQ4 ä»£æ›¿ Q5ï¼‰
ollama pull qwen2.5:7b-instruct-q4_K_M

# 2. å‡å°‘ä¸Šä¸‹æ–‡çª—å£å¤§å°
# åœ¨ä»£ç ä¸­è®¾ç½® num_ctx: 2048ï¼ˆé»˜è®¤æ˜¯ 8192ï¼‰
```

---

### Q3: è¾“å‡ºä¸æ˜¯çº¯ JSONï¼ŒåŒ…å«é¢å¤–æ–‡å­—ï¼Ÿ

**A**:
```javascript
// æ–¹æ³• 1: åœ¨æç¤ºè¯ä¸­å¼ºè°ƒ
const systemPrompt = `ä½ å¿…é¡»ä¸”åªèƒ½è¾“å‡º JSONï¼Œä¸è¦æ·»åŠ ä»»ä½•é¢å¤–æ–‡å­—ã€‚
ä¸è¦è¯´"å¥½çš„"ã€"è¿™æ˜¯JSON"ç­‰ï¼Œç›´æ¥è¾“å‡º JSONã€‚`;

// æ–¹æ³• 2: åœ¨ä»£ç ä¸­æ¸…ç†
function cleanJsonOutput(rawOutput) {
    // å»é™¤ markdown ä»£ç å—æ ‡è®°
    let cleaned = rawOutput.trim();
    cleaned = cleaned.replace(/^```json\n/, '').replace(/\n```$/, '');

    // æå– JSON å¯¹è±¡
    const jsonMatch = cleaned.match(/\{[\s\S]*\}/);
    if (jsonMatch) {
        return JSON.parse(jsonMatch[0]);
    }

    throw new Error('No valid JSON found in output');
}
```

---

### Q4: å“åº”é€Ÿåº¦å¤ªæ…¢ï¼Ÿ

**A**:
```bash
# 1. ä½¿ç”¨ GPU åŠ é€Ÿï¼ˆå¦‚æœæœ‰ NVIDIA æ˜¾å¡ï¼‰
# Ollama è‡ªåŠ¨æ£€æµ‹ GPUï¼Œæ— éœ€é¢å¤–é…ç½®

# 2. å‡å°‘ç”Ÿæˆé•¿åº¦
# åœ¨è¯·æ±‚ä¸­è®¾ç½®:
options: {
    num_predict: 256  // æœ€å¤šç”Ÿæˆ 256 tokens
}

# 3. ä½¿ç”¨æ›´å°çš„æ¨¡å‹
ollama pull qwen2.5:3b-instruct  # æ›´å¿«ä½†è´¨é‡ç•¥ä½

# 4. é™ä½é‡åŒ–çº§åˆ«
ollama pull qwen2.5:7b-instruct-q4_K_M  # Q4 æ¯” Q5 å¿« ~15%
```

---

### Q5: å¦‚ä½•åœ¨å¤šä¸ªæ¨¡å‹é—´åˆ‡æ¢ï¼Ÿ

**A**:
```javascript
// ç­–ç•¥ 1: æ ¹æ®ä»»åŠ¡ç±»å‹è·¯ç”±
async function selectModel(taskType) {
    const modelMap = {
        'deep_question': 'qwen2.5:7b-instruct-q5_K_M',
        'analysis': 'deepseek-r1:7b',
        'empathy': 'vortex/helpingai-9b'
    };

    return modelMap[taskType];
}

// ç­–ç•¥ 2: A/B æµ‹è¯•
async function compareModels(prompt, models) {
    const results = await Promise.all(
        models.map(model =>
            ollama.chat({ model, messages: [{ role: 'user', content: prompt }] })
        )
    );

    return results;  // äººå·¥å¯¹æ¯”é€‰æ‹©æœ€ä½³
}
```

---

### Q6: å¦‚ä½•ä¿å­˜å’Œç®¡ç†å¯¹è¯å†å²ï¼Ÿ

**A**:
```javascript
// ç®€å•çš„å¯¹è¯ç®¡ç†å™¨
class ConversationManager {
    constructor(maxHistory = 10) {
        this.messages = [];
        this.maxHistory = maxHistory;
    }

    addMessage(role, content) {
        this.messages.push({ role, content });

        // ä¿æŒæœ€è¿‘ N è½®å¯¹è¯
        if (this.messages.length > this.maxHistory * 2) {
            this.messages = this.messages.slice(-this.maxHistory * 2);
        }
    }

    async chat(model, userInput) {
        this.addMessage('user', userInput);

        const response = await ollama.chat({
            model,
            messages: this.messages
        });

        this.addMessage('assistant', response.message.content);
        return response.message.content;
    }

    clear() {
        this.messages = [];
    }
}
```

---

## ä¸‹ä¸€æ­¥è¡ŒåŠ¨

å®Œæˆå¿«é€ŸéªŒè¯åï¼Œä½ å¯ä»¥ï¼š

1. **é˜…è¯»è¯¦ç»†æŠ¥å‘Š**
   â†’ `docs/ä¸ªäººç”»åƒæ¨¡å‹é€‰å‹è°ƒç ”æŠ¥å‘Š.md`

2. **æ¢ç´¢æç¤ºè¯å·¥ç¨‹**
   â†’ å‚è€ƒæŠ¥å‘Šä¸­çš„"æç¤ºè¯ä¼˜åŒ–å»ºè®®"ç« èŠ‚

3. **å®ç°å¤šæ¨¡å‹åä½œ**
   â†’ å‚è€ƒæŠ¥å‘Šä¸­çš„"å¤šæ¨¡å‹åä½œæ¶æ„"

4. **å¾®è°ƒæ¨¡å‹**ï¼ˆé«˜çº§ï¼‰
   â†’ å¦‚æœæœ‰ç‰¹å®šé¢†åŸŸæ•°æ®ï¼Œè€ƒè™‘å¾®è°ƒ Qwen2.5

5. **ç›‘æ§ç”Ÿäº§æ€§èƒ½**
   â†’ è®°å½•å“åº”æ—¶é—´ã€è´¨é‡è¯„åˆ†ï¼ŒæŒç»­ä¼˜åŒ–

---

## å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] Ollama å·²å®‰è£…å¹¶è¿è¡Œ
- [ ] å·²ä¸‹è½½è‡³å°‘ä¸€ä¸ªæ¨èæ¨¡å‹
- [ ] è¿è¡Œè¿‡å‘½ä»¤è¡Œæµ‹è¯•æˆ–è‡ªåŠ¨åŒ–æµ‹è¯•
- [ ] æ‰‹åŠ¨è¯„ä¼°è¿‡è¾“å‡ºè´¨é‡
- [ ] æ ¹æ®å†³ç­–æ ‘é€‰æ‹©äº†æœ€é€‚åˆçš„æ¨¡å‹
- [ ] æˆåŠŸé›†æˆåˆ°é¡¹ç›®ä»£ç ä¸­
- [ ] é˜…è¯»äº†å®Œæ•´çš„è°ƒç ”æŠ¥å‘Š

---

**éœ€è¦å¸®åŠ©ï¼Ÿ**

- æŸ¥çœ‹è°ƒç ”æŠ¥å‘Šä¸­çš„"å¸¸è§é—®é¢˜"ç« èŠ‚
- è®¿é—® Ollama å®˜æ–¹æ–‡æ¡£ï¼šhttps://ollama.com/docs
- åŠ å…¥ LocalLLaMA ç¤¾åŒºï¼šhttps://www.reddit.com/r/LocalLLaMA/

---

**ç¥ä½ é¡ºåˆ©å®Œæˆæ¨¡å‹é€‰å‹ï¼ğŸš€**
