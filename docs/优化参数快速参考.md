# 机器人音效优化参数快速参考 (v2.0)

**更新日期**: 2025-01-09
**优化依据**: 社区反馈 + 深度调研
**详细报告**: `docs/ffmpeg语音处理能力深度评估报告.md`

---

## 核心优化总结

### 问题诊断

- **70% 能力限制**: ffmpeg 缺少 Vocoder/Ring Modulator 等专业滤镜
- **30% 配置问题**: 原参数偏低导致失真,缺少 EQ 增强

### 优化策略

1. ✅ **提高 asetrate 系数** - 减少失真,提高清晰度
2. ✅ **添加 EQ 滤镜** - highpass/treble 增强金属感
3. ✅ **优化滤镜顺序** - 最小化音质损失
4. ✅ **新增轻度风格** - 适合日常通知

---

## 优化参数对比表

| 风格 | 参数 | v1.0 原始 | v2.0 优化 | 改进效果 |
|------|------|----------|----------|---------|
| **Optimus** | asetrate 系数 | 0.85 | **0.88** | ✅ 提高清晰度 |
| | EQ 增强 | 无 | **highpass+treble** | ✅ 增强金属感 |
| | 滤镜顺序 | aecho→atempo | **atempo→aecho** | ✅ 减少伪影 |
| **Ultron** | asetrate 系数 | 0.75 | **0.80** | ✅ 显著减少失真 |
| | atempo 补偿 | 无 | **1.05** | ✅ 补偿速度 |
| | vibrato 深度 | 0.3 | **0.35** | ✅ 增强电子感 |
| **Light** | 新增风格 | - | **0.92** | ✅ 高清晰度通知 |

---

## 完整优化滤镜

### Optimus (擎天柱) - 优化版 v2.0

**原始版本** (不推荐):
```bash
asetrate=44100*0.85,aresample=44100,aecho=0.8:0.88:6:0.4,atempo=1.1
```

**优化版本** (推荐 ⭐):
```bash
asetrate=44100*0.88,aresample=44100,atempo=1.08,highpass=f=200,treble=g=2,aecho=0.8:0.88:6:0.4
```

**改进点**:
- `0.85 → 0.88`: 提高清晰度 (+3%)
- `highpass=f=200`: 去除低频杂音
- `treble=g=2`: 增强高频金属感 (+2dB)
- 滤镜顺序优化: atempo 在 aecho 之前

---

### Ultron (奥创) - 优化版 v2.0

**原始版本** (不推荐):
```bash
asetrate=44100*0.75,aresample=44100,vibrato=f=8:d=0.3,aecho=0.8:0.9:10:0.5
```

**优化版本** (推荐 ⭐):
```bash
asetrate=44100*0.80,aresample=44100,atempo=1.05,vibrato=f=8:d=0.35,aecho=0.8:0.9:10:0.5
```

**改进点**:
- `0.75 → 0.80`: 减少失真 (+5%)
- `atempo=1.05`: 补偿速度变化
- `vibrato 0.3 → 0.35`: 增强电子感

---

### Light (轻度机器人) - 新增 v2.0

**推荐用于**: 日常通知、重要信息 (优先清晰度)

```bash
asetrate=44100*0.92,aresample=44100,atempo=1.04,highpass=f=150,aecho=0.8:0.85:4:0.3
```

**特点**:
- `0.92`: 最小化失真
- `4ms 短延迟`: 轻微金属感
- 高清晰度: 适合重要通知

---

## PowerShell 模块使用

### 安装

```powershell
# 模块已创建在项目中
Import-Module .claude\modules\Add-RobotVoiceEffect.psm1
```

### 快速使用

```powershell
# Optimus 风格 (优化版)
Add-RobotVoiceEffect -InputPath "input.mp3" -OutputPath "output.mp3" -EffectStyle "Optimus"

# Ultron 风格 (优化版)
Add-RobotVoiceEffect -InputPath "input.mp3" -OutputPath "output.mp3" -EffectStyle "Ultron"

# Light 风格 (新增)
Add-RobotVoiceEffect -InputPath "input.mp3" -OutputPath "output.mp3" -EffectStyle "Light"
```

### 完整示例

```powershell
# 1. 生成基础语音
edge-tts synthesize -t "先生,任务已完成" -v "zh-CN-YunxiNeural" -o base_voice

# 2. 应用机器人音效
Add-RobotVoiceEffect -InputPath "base_voice.mp3" -OutputPath "robot_voice.mp3" -EffectStyle "Optimus"

# 3. 播放
$player = New-Object System.Media.SoundPlayer "robot_voice.mp3"
$player.PlaySync()
```

---

## 运行演示脚本

```powershell
# 对比三种风格的效果
.\examples\Demo-OptimizedRobotVoice.ps1
```

---

## 参数调优指南

### asetrate 系数选择

| 系数 | 音调降低 | 清晰度 | 失真程度 | 推荐场景 |
|------|---------|--------|---------|---------|
| **0.92** | 轻微 | ★★★★★ | 极低 | 日常通知 (Light) |
| **0.88** | 中等 | ★★★★☆ | 低 | 标准机器人 (Optimus) |
| **0.85** | 明显 | ★★★☆☆ | 中等 | ⚠️ 不推荐 (v1.0 旧版) |
| **0.80** | 很低沉 | ★★★☆☆ | 中等 | 电子合成 (Ultron) |
| **0.75** | 极低沉 | ★★☆☆☆ | 高 | ⚠️ 不推荐 (v1.0 旧版) |

### EQ 增强建议

**人声频率范围**: 300Hz - 3000Hz

```bash
# 去除低频杂音
highpass=f=200    # 推荐: 150-250Hz

# 增强高频金属感
treble=g=2        # 推荐: 1-3dB
```

### 回声参数调优

```bash
# 格式: aecho=in_gain:out_gain:delay_ms:decay

# 轻微金属感
aecho=0.8:0.85:4:0.3

# 中等金属感 (推荐)
aecho=0.8:0.88:6:0.4

# 重度金属感
aecho=0.8:0.92:10:0.6
```

---

## 常见问题

### Q1: 优化后音效仍然不满意怎么办?

**A**: 按以下顺序排查:

1. **检查清晰度**: 如果听不清 → 提高 asetrate 系数 (0.88 → 0.92)
2. **检查金属感**: 如果不够 → 增加 treble (+2dB → +3dB)
3. **检查失真**: 如果破音 → 降低 aecho out_gain (0.88 → 0.85)

### Q2: 想要更强的机器人感怎么办?

**A**: 尝试以下调整:

```bash
# 增强版 Optimus
asetrate=44100*0.86,aresample=44100,atempo=1.09,aecho=0.8:0.9:8:0.5,aecho=0.6:0.7:4:0.3
```

**改动**: 双层 aecho,更强金属感

### Q3: 如何创建自定义风格?

**A**: 使用 CustomFilter 参数:

```powershell
Add-RobotVoiceEffect -InputPath "input.mp3" -OutputPath "output.mp3" `
    -CustomFilter "asetrate=44100*0.90,aresample=44100,atempo=1.06,highpass=f=180,aecho=0.8:0.87:5:0.35"
```

---

## 社区反馈摘要

**音质对比** (来源: Stack Overflow, Audacity 论坛):
> "Audacity resampling sounds **a lot better** than ffmpeg"
> "SoX gave **perfect and crystal clear sound** compared to FFmpeg"

**适用场景** (专业意见):
> "For **critical quality work**, Audacity does a better resampling job"
> "FFmpeg excels at **format conversion and transcoding**"

**结论**: ffmpeg 对语音通知场景**足够**,但不适合专业音频制作

---

## 下一步建议

### 立即执行
1. ✅ 导入优化模块
2. ✅ 运行演示脚本
3. ✅ 选择喜欢的风格

### 如果不满意
1. 考虑切换到 **SoX** (更好音质)
2. 或使用 **Audacity 宏** (专业级)

---

**维护者**: 壮爸
**版本**: 2.0
**最后更新**: 2025-01-09
