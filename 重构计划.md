# Voice Notification Project æ¶æ„é‡æ„è®¡åˆ’

> **åˆ›å»ºæ—¥æœŸ**: 2025-11-25
> **ç»´æŠ¤è€…**: å£®çˆ¸
> **çŠ¶æ€**: âœ… å·²å®Œæˆ
> **å®Œæˆæ—¥æœŸ**: 2025-11-25

---

## ä¸€ã€é‡æ„ç›®æ ‡

### æ ¸å¿ƒåŸåˆ™

1. **åŠŸèƒ½æ¨¡å—èšåˆ** - ä¸€ä¸ªåŠŸèƒ½çš„æ‰€æœ‰ä»£ç ï¼ˆå‰ç«¯ã€åç«¯ã€æœåŠ¡ã€æ•°æ®ï¼‰æ”¾åœ¨åŒä¸€ç›®å½•
2. **æŠ€æœ¯æ ˆç»Ÿä¸€** - å…¨é¢é‡‡ç”¨ TypeScript + React + Tailwind CSS + Express 5
3. **å•ä¸€ node_modules** - ä½¿ç”¨ pnpm workspace å…±äº«ä¾èµ–
4. **å¯è¿ç§»æ€§** - ä»»æ„æ¨¡å—å¯æ•´ä½“å¤åˆ¶åˆ°å…¶ä»–é¡¹ç›®
5. **Pip-Boy æ•ˆæœ 100% ä¿ç•™** - ä»¥ `pip-boy-theme` çš„è§†è§‰æ•ˆæœä¸ºå‡†ï¼Œå‡çº§æŠ€æœ¯å®ç°

### é‡æ„å‰åå¯¹æ¯”

```
é‡æ„å‰ï¼ˆæŒ‰æŠ€æœ¯æ ˆåˆ†ç¦»ï¼‰              é‡æ„åï¼ˆæŒ‰åŠŸèƒ½èšåˆï¼‰
================================    ================================
scripts/                            modules/
â”œâ”€â”€ profile/                        â”œâ”€â”€ log-viewer/
â”œâ”€â”€ rag/                            â”‚   â”œâ”€â”€ frontend/
â””â”€â”€ viewers/log-viewers/            â”‚   â”œâ”€â”€ backend/
                                    â”‚   â””â”€â”€ README.md
services/                           â”‚
â”œâ”€â”€ embedding-service.js            â”œâ”€â”€ profile/
â”œâ”€â”€ hybrid-retrieval.js             â”‚   â”œâ”€â”€ frontend/
â””â”€â”€ profile/                        â”‚   â”œâ”€â”€ backend/
                                    â”‚   â”œâ”€â”€ services/
viewers/                            â”‚   â”œâ”€â”€ data/
â”œâ”€â”€ log-viewer/                     â”‚   â””â”€â”€ README.md
â”œâ”€â”€ user-profile/                   â”‚
â”œâ”€â”€ pip-boy-theme/                  â””â”€â”€ rag/
â””â”€â”€ rag-memory/                         â”œâ”€â”€ services/
                                        â”œâ”€â”€ scripts/
data/                                   â”œâ”€â”€ data/
â”œâ”€â”€ memory.db                           â””â”€â”€ README.md
â”œâ”€â”€ rag-database.db
â””â”€â”€ profile/                        packages/
                                    â””â”€â”€ pip-boy-theme/
portals/                                â”œâ”€â”€ tailwind-preset.js
â””â”€â”€ main/                               â”œâ”€â”€ hooks/
                                        â””â”€â”€ components/
tests/
â”œâ”€â”€ Test-*.ps1                      data/
â””â”€â”€ test-*.js                       â””â”€â”€ voice-notification.db (é‡å‘½å)

                                    portals/
                                    â””â”€â”€ main/

                                    tests/
                                    â”œâ”€â”€ rag/
                                    â””â”€â”€ voice/
```

---

## äºŒã€ç›®æ ‡æ¶æ„è¯¦å›¾

```
voice-notification-project/
â”‚
â”œâ”€â”€ modules/                           # åŠŸèƒ½æ¨¡å—ï¼ˆå¯ç‹¬ç«‹è¿ç§»ï¼‰
â”‚   â”‚
â”‚   â”œâ”€â”€ log-viewer/                    # æ—¥å¿—æŸ¥çœ‹å™¨æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ frontend/                  # React å‰ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LogList.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LogDetail.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ SessionManager.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ hooks/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ useLogData.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ index.html
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ backend/                   # TypeScript åç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ log-parser.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ file-watcher.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config.json                # æ¨¡å—é…ç½®ï¼ˆç«¯å£ 55555ï¼‰
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â”œâ”€â”€ profile/                       # ä¸ªäººç”»åƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ frontend/                  # React å‰ç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ App.tsx
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Questionnaire.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Interview.tsx
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Approval.tsx
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ components/
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ backend/                   # TypeScript åç«¯
â”‚   â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ server.ts
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ migrate.ts
â”‚   â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ services/                  # ä¸“ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ ollama-service.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ data/                      # ç‹¬ç«‹æ•°æ®
â”‚   â”‚   â”‚   â””â”€â”€ profile.db
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config.json                # æ¨¡å—é…ç½®ï¼ˆç«¯å£ 3002ï¼‰
â”‚   â”‚   â””â”€â”€ README.md
â”‚   â”‚
â”‚   â””â”€â”€ rag/                           # RAG çŸ¥è¯†åº“æ¨¡å—
â”‚       â”œâ”€â”€ services/                  # RAG æœåŠ¡
â”‚       â”‚   â”œâ”€â”€ embedding-service.ts
â”‚       â”‚   â””â”€â”€ hybrid-retrieval.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ scripts/                   # å·¥å…·è„šæœ¬
â”‚       â”‚   â”œâ”€â”€ init-database.ts
â”‚       â”‚   â””â”€â”€ view-database.ts
â”‚       â”‚
â”‚       â”œâ”€â”€ data/                      # RAG æ•°æ®
â”‚       â”‚   â””â”€â”€ rag-database.db
â”‚       â”‚
â”‚       â”œâ”€â”€ config.json
â”‚       â””â”€â”€ README.md
â”‚
â”œâ”€â”€ packages/                          # å…±äº«åº“
â”‚   â””â”€â”€ pip-boy-theme/                 # Pip-Boy ä¸»é¢˜åŒ…ï¼ˆTailwind åŒ–ï¼‰
â”‚       â”œâ”€â”€ tailwind-preset.js         # Tailwind é¢„è®¾é…ç½®
â”‚       â”œâ”€â”€ crt-plugin.js              # CRT æ•ˆæœæ’ä»¶
â”‚       â”œâ”€â”€ styles/
â”‚       â”‚   â””â”€â”€ base.css               # åŸºç¡€æ ·å¼ï¼ˆæ»šåŠ¨æ¡ç­‰ï¼‰
â”‚       â”œâ”€â”€ hooks/
â”‚       â”‚   â”œâ”€â”€ useKeyboardNavigation.ts
â”‚       â”‚   â””â”€â”€ useDataLoader.ts
â”‚       â”œâ”€â”€ components/
â”‚       â”‚   â”œâ”€â”€ CRTScreen.tsx
â”‚       â”‚   â”œâ”€â”€ TabBar.tsx
â”‚       â”‚   â”œâ”€â”€ StatusBar.tsx
â”‚       â”‚   â”œâ”€â”€ PipBoyButton.tsx
â”‚       â”‚   â”œâ”€â”€ PipBoyList.tsx
â”‚       â”‚   â”œâ”€â”€ PipBoyPanel.tsx
â”‚       â”‚   â””â”€â”€ index.ts
â”‚       â”œâ”€â”€ fonts/
â”‚       â”‚   â””â”€â”€ VT323/
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ README.md
â”‚
â”œâ”€â”€ portals/                           # å…¥å£é—¨æˆ·
â”‚   â””â”€â”€ main/                          # ä¸»å…¥å£ï¼ˆèšåˆæ‰€æœ‰æ¨¡å—ï¼‰
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.tsx
â”‚       â”‚   â”œâ”€â”€ App.tsx
â”‚       â”‚   â”œâ”€â”€ pages/
â”‚       â”‚   â”‚   â”œâ”€â”€ MainMenu.tsx
â”‚       â”‚   â”‚   â”œâ”€â”€ LogViewerPage.tsx      # åµŒå…¥ log-viewer
â”‚       â”‚   â”‚   â”œâ”€â”€ ProfilePage.tsx        # åµŒå…¥ profile
â”‚       â”‚   â”‚   â””â”€â”€ ServiceView.tsx
â”‚       â”‚   â”œâ”€â”€ components/
â”‚       â”‚   â””â”€â”€ services/
â”‚       â”œâ”€â”€ vite.config.ts
â”‚       â”œâ”€â”€ tailwind.config.ts             # å¼•å…¥ pip-boy-theme é¢„è®¾
â”‚       â””â”€â”€ package.json
â”‚
â”œâ”€â”€ tests/                             # æµ‹è¯•ç›®å½•ï¼ˆé‡ç»„ï¼‰
â”‚   â”œâ”€â”€ rag/                           # RAG ç›¸å…³æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ test-retrieval.js
â”‚   â”‚   â””â”€â”€ test-model-selection.js
â”‚   â”‚
â”‚   â”œâ”€â”€ voice/                         # è¯­éŸ³é€šçŸ¥æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ Test-VoiceNotification.ps1
â”‚   â”‚   â”œâ”€â”€ Test-Integration.ps1
â”‚   â”‚   â”œâ”€â”€ Test-PlaySound.ps1
â”‚   â”‚   â””â”€â”€ Test-ErrorMonitor.ps1
â”‚   â”‚
â”‚   â””â”€â”€ README.md
â”‚
â”œâ”€â”€ scripts/                           # å…¨å±€è„šæœ¬
â”‚   â”œâ”€â”€ Install-Dependencies.ps1
â”‚   â””â”€â”€ start-all.ps1                  # å¯åŠ¨æ‰€æœ‰æœåŠ¡
â”‚
â”œâ”€â”€ data/                              # é—ç•™/å…¨å±€æ•°æ®
â”‚   â””â”€â”€ voice-notification.db          # é‡å‘½åè‡ª memory.db
â”‚
â”œâ”€â”€ .claude/                           # Claude Code é…ç½®ï¼ˆä¸åŠ¨ï¼‰
â”œâ”€â”€ docs/                              # æ–‡æ¡£ï¼ˆä¸åŠ¨ï¼‰
â”‚
â”œâ”€â”€ package.json                       # æ ¹ workspace é…ç½®
â”œâ”€â”€ pnpm-workspace.yaml                # pnpm å·¥ä½œåŒº
â”œâ”€â”€ tsconfig.base.json                 # å…±äº« TS é…ç½®
â”œâ”€â”€ .editorconfig
â”œâ”€â”€ .gitignore
â””â”€â”€ README.md
```

---

## ä¸‰ã€åˆ†é˜¶æ®µæ‰§è¡Œè®¡åˆ’

### é˜¶æ®µ 0ï¼šå‡†å¤‡å·¥ä½œï¼ˆé¢„è®¡ 1 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šæ¸…ç†ã€å¤‡ä»½ã€å»ºç«‹åŸºç¡€ç»“æ„

| åºå· | ä»»åŠ¡ | è¯¦ç»†è¯´æ˜ |
|------|------|----------|
| 0.1 | Git å¤‡ä»½ | åˆ›å»º `backup/pre-refactor` åˆ†æ”¯ |
| 0.2 | åˆ é™¤æ— ç”¨ç›®å½• | `scripts/viewers/shared/`ã€`viewers/rag-memory/` |
| 0.3 | é‡å‘½å memory.db | `data/memory.db` â†’ `data/voice-notification.db` |
| 0.4 | åˆ›å»ºç›®æ ‡ç›®å½•ç»“æ„ | `modules/`ã€`packages/` ç©ºç›®å½• |
| 0.5 | åˆå§‹åŒ– pnpm workspace | åˆ›å»º `pnpm-workspace.yaml` |
| 0.6 | åˆ›å»ºå…±äº« tsconfig | `tsconfig.base.json` |

**éªŒè¯ç‚¹**ï¼š
- [ ] å¤‡ä»½åˆ†æ”¯å·²åˆ›å»º
- [ ] ç›®å½•ç»“æ„ç¬¦åˆç›®æ ‡æ¶æ„
- [ ] `pnpm install` åœ¨æ ¹ç›®å½•æˆåŠŸæ‰§è¡Œ

---

### é˜¶æ®µ 1ï¼špip-boy-theme Tailwind åŒ–ï¼ˆé¢„è®¡ 3-4 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šå°†çº¯ CSS ä¸»é¢˜è½¬æ¢ä¸º Tailwind é¢„è®¾ + React ç»„ä»¶ï¼Œ100% ä¿ç•™è§†è§‰æ•ˆæœ

#### 1.1 åˆ›å»º Tailwind é¢„è®¾

**æ–‡ä»¶**ï¼š`packages/pip-boy-theme/tailwind-preset.js`

```javascript
// ä» pip-boy-theme/css/pip-boy-colors.css æå–
module.exports = {
  theme: {
    extend: {
      colors: {
        'pip-boy': {
          green: '#4af626',           // ä¸»è‰²ï¼ˆæ¥è‡ªåŸ pip-boy-themeï¼‰
          'green-bright': '#5cff38',
          'green-dim': '#3ac41e',
          'green-dark': '#1a5c0e',
          bg: '#0a0a0a',
          'bg-light': '#141414',
          amber: '#ffb000',
          'text-primary': '#4af626',
          'text-secondary': '#3ac41e',
          'text-muted': '#2a8c14',
        }
      },
      fontFamily: {
        'terminal': ['VT323', 'Courier New', 'monospace'],
      },
      boxShadow: {
        'pip-glow': '0 0 10px rgba(74, 246, 38, 0.5)',
        'pip-glow-strong': '0 0 20px rgba(74, 246, 38, 0.7)',
        'pip-glow-multi': '0 0 5px #4af626, 0 0 10px #4af626, 0 0 20px #4af626',
      },
      animation: {
        'scanline': 'scanline 8s linear infinite',
        'flicker': 'flicker 0.15s infinite',
        'boot': 'boot 2s ease-out',
      },
      keyframes: {
        scanline: {
          '0%': { transform: 'translateY(-100%)' },
          '100%': { transform: 'translateY(100vh)' },
        },
        flicker: {
          '0%, 100%': { opacity: '1' },
          '50%': { opacity: '0.97' },
        },
        boot: {
          '0%': { opacity: '0', transform: 'scale(0.95)' },
          '100%': { opacity: '1', transform: 'scale(1)' },
        },
      },
    },
  },
}
```

#### 1.2 åˆ›å»º CRT æ•ˆæœæ’ä»¶

**æ–‡ä»¶**ï¼š`packages/pip-boy-theme/crt-plugin.js`

```javascript
// ä» pip-boy-theme/css/pip-boy-crt.css æå–
const plugin = require('tailwindcss/plugin')

module.exports = plugin(function({ addComponents, addUtilities }) {
  // æ‰«æçº¿æ•ˆæœ
  addComponents({
    '.pip-boy-scanlines': {
      position: 'relative',
      '&::after': {
        content: '""',
        position: 'absolute',
        top: '0',
        left: '0',
        width: '100%',
        height: '100%',
        background: 'repeating-linear-gradient(0deg, rgba(0,0,0,0.15), rgba(0,0,0,0.15) 1px, transparent 1px, transparent 2px)',
        pointerEvents: 'none',
        zIndex: '99',
      },
    },
    '.pip-boy-scanline-moving': {
      '&::before': {
        content: '""',
        position: 'absolute',
        top: '0',
        left: '0',
        width: '100%',
        height: '2px',
        background: 'linear-gradient(to bottom, transparent, rgba(74, 246, 38, 0.3), transparent)',
        animation: 'scanline 8s linear infinite',
        zIndex: '100',
        pointerEvents: 'none',
      },
    },
  })

  // å‘å…‰æ•ˆæœ
  addUtilities({
    '.pip-boy-glow': {
      textShadow: '0 0 5px rgba(74, 246, 38, 0.8)',
    },
    '.pip-boy-glow-multi': {
      textShadow: '0 0 5px #4af626, 0 0 10px #4af626, 0 0 20px #4af626, 0 0 40px #4af626',
    },
    '.pip-boy-box-glow': {
      boxShadow: '0 0 10px rgba(74, 246, 38, 0.3), inset 0 0 30px rgba(74, 246, 38, 0.05)',
    },
  })
})
```

#### 1.3 ç§»æ¤ React ç»„ä»¶

ä»é—¨æˆ·çš„ç»„ä»¶åŸºç¡€ä¸Šï¼Œå¢å¼ºä¸º 100% è¿˜åŸ pip-boy-theme æ•ˆæœï¼š

| ç»„ä»¶ | åŠŸèƒ½ | å…³é”®æ•ˆæœè¿˜åŸ |
|------|------|-------------|
| `CRTScreen.tsx` | å±å¹•å®¹å™¨ | æ‰«æçº¿ã€é—ªçƒã€èƒŒæ™¯æ¸å˜ |
| `PipBoyList.tsx` | åˆ—è¡¨ç»„ä»¶ | é€‰ä¸­é«˜äº®ã€é”®ç›˜å¯¼èˆª |
| `PipBoyPanel.tsx` | é¢æ¿ç»„ä»¶ | è¾¹æ¡†å‘å…‰ã€å†…é˜´å½± |
| `PipBoyButton.tsx` | æŒ‰é’®ç»„ä»¶ | æ‚¬åœå‘å…‰ã€ç‚¹å‡»åé¦ˆ |
| `PipBoyTable.tsx` | è¡¨æ ¼ç»„ä»¶ | äº¤æ›¿è¡Œã€è¡¨å¤´æ ·å¼ |
| `PipBoyBadge.tsx` | å¾½ç« ç»„ä»¶ | çŠ¶æ€é¢œè‰²ï¼ˆæˆåŠŸ/è­¦å‘Š/é”™è¯¯ï¼‰ |

#### 1.4 ç§»æ¤ JavaScript åŠŸèƒ½ä¸º React Hooks

| åŸæ–‡ä»¶ | æ–° Hook | åŠŸèƒ½ |
|--------|---------|------|
| `keyboard-navigation.js` | `useKeyboardNavigation.ts` | æ–¹å‘é”®å¯¼èˆªã€Enter é€‰æ‹©ã€Esc è¿”å› |
| `data-loader.js` | `useDataLoader.ts` | æ•°æ®åŠ è½½ã€ç¼“å­˜ã€é‡è¯• |

**éªŒè¯ç‚¹**ï¼š
- [ ] åˆ›å»º demo é¡µé¢ï¼Œå¯¹æ¯”æ–°æ—§æ•ˆæœæˆªå›¾
- [ ] æ‰€æœ‰ CRT æ•ˆæœï¼ˆæ‰«æçº¿ã€é—ªçƒã€å‘å…‰ï¼‰100% è¿˜åŸ
- [ ] é”®ç›˜å¯¼èˆªåŠŸèƒ½æ­£å¸¸

---

### é˜¶æ®µ 2ï¼šlog-viewer æ¨¡å—è¿ç§»ï¼ˆé¢„è®¡ 2-3 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šå°†åˆ†æ•£çš„æ—¥å¿—æŸ¥çœ‹å™¨ä»£ç èšåˆåˆ° `modules/log-viewer/`

#### 2.1 æ–‡ä»¶è¿ç§»æ¸…å•

| åŸä½ç½® | æ–°ä½ç½® | è¯´æ˜ |
|--------|--------|------|
| `scripts/viewers/log-viewers/node-server/src/*` | `modules/log-viewer/backend/src/` | åç«¯æºç  |
| `scripts/viewers/log-viewers/node-server/package.json` | `modules/log-viewer/backend/package.json` | ä¾èµ–é…ç½® |
| `scripts/viewers/log-viewers/node-server/tsconfig.json` | `modules/log-viewer/backend/tsconfig.json` | TS é…ç½® |
| `viewers/log-viewer/index.html` | **åˆ é™¤** | å°†ç”¨ React é‡å†™ |
| `viewers/log-viewer/js/*` | **è½¬æ¢** | é€»è¾‘ç§»å…¥ React ç»„ä»¶ |
| `viewers/log-viewer/data/logs.json` | `modules/log-viewer/data/logs.json` | æ•°æ®æ–‡ä»¶ |

#### 2.2 å‰ç«¯ React åŒ–

å°†åŸç”Ÿ JS é€»è¾‘è½¬æ¢ä¸º Reactï¼š

```
modules/log-viewer/frontend/src/
â”œâ”€â”€ App.tsx                    # ä¸»åº”ç”¨
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LogList.tsx            # åŸ session-manager.js é€»è¾‘
â”‚   â”œâ”€â”€ LogDetail.tsx          # åŸ log-renderer.js é€»è¾‘
â”‚   â””â”€â”€ SearchBar.tsx          # æœç´¢åŠŸèƒ½
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useLogData.ts          # æ•°æ®åŠ è½½
â”‚   â””â”€â”€ useLongPolling.ts      # å®æ—¶æ›´æ–°
â””â”€â”€ types/
    â””â”€â”€ log.ts                 # ç±»å‹å®šä¹‰
```

#### 2.3 åç«¯å‡çº§

- Express 4 â†’ Express 5
- æ·»åŠ  ESM æ”¯æŒ
- ç»Ÿä¸€é”™è¯¯å¤„ç†

#### 2.4 è·¯å¾„æ›´æ–°

```typescript
// åç«¯é…ç½® - modules/log-viewer/backend/src/config.ts
export const config = {
  port: 55555,
  dataPath: path.join(__dirname, '../../data/logs.json'),
}
```

**éªŒè¯ç‚¹**ï¼š
- [ ] `pnpm --filter @modules/log-viewer dev` å¯åŠ¨æˆåŠŸ
- [ ] æ—¥å¿—åˆ—è¡¨æ˜¾ç¤ºæ­£å¸¸
- [ ] é”®ç›˜å¯¼èˆªæ­£å¸¸
- [ ] å®æ—¶æ›´æ–°æ­£å¸¸

---

### é˜¶æ®µ 3ï¼šprofile æ¨¡å—è¿ç§»ï¼ˆé¢„è®¡ 3-4 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šèšåˆä¸ªäººç”»åƒç³»ç»Ÿçš„æ‰€æœ‰ä»£ç 

#### 3.1 æ–‡ä»¶è¿ç§»æ¸…å•

| åŸä½ç½® | æ–°ä½ç½® |
|--------|--------|
| `scripts/profile/server.js` | `modules/profile/backend/src/server.ts` |
| `scripts/profile/start.js` | `modules/profile/backend/src/start.ts` |
| `scripts/profile/migrate.js` | `modules/profile/backend/src/migrate.ts` |
| `scripts/profile/config.json` | `modules/profile/config.json` |
| `scripts/profile/tools/*` | `modules/profile/tools/` |
| `services/profile/ollama-service.js` | `modules/profile/services/ollama-service.ts` |
| `viewers/user-profile/*.html` | **è½¬æ¢ä¸º React** |
| `viewers/user-profile/js/*` | **è½¬æ¢ä¸º React** |
| `data/profile/profile.db` | `modules/profile/data/profile.db` |

#### 3.2 å‰ç«¯ React åŒ–

```
modules/profile/frontend/src/
â”œâ”€â”€ App.tsx
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ Questionnaire.tsx      # åŸ questionnaire.html + js
â”‚   â”œâ”€â”€ Interview.tsx          # åŸ interview.html + js
â”‚   â””â”€â”€ Approval.tsx           # åŸ approval.html + js
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ QuestionCard.tsx
â”‚   â”œâ”€â”€ ChatBubble.tsx
â”‚   â””â”€â”€ InsightPanel.tsx
â””â”€â”€ hooks/
    â””â”€â”€ useInterview.ts        # è®¿è°ˆçŠ¶æ€ç®¡ç†
```

#### 3.3 åç«¯ TypeScript åŒ–

- æ‰€æœ‰ `.js` â†’ `.ts`
- æ·»åŠ ç±»å‹å®šä¹‰
- ç»Ÿä¸€ API å“åº”æ ¼å¼

**éªŒè¯ç‚¹**ï¼š
- [ ] é—®å·é¡µé¢æ­£å¸¸
- [ ] è®¿è°ˆæµç¨‹å®Œæ•´
- [ ] AI å¯¹è¯åŠŸèƒ½æ­£å¸¸
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸

---

### é˜¶æ®µ 4ï¼šRAG æ¨¡å—è¿ç§»ï¼ˆé¢„è®¡ 1-2 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šèšåˆ RAG çŸ¥è¯†åº“ä»£ç 

#### 4.1 æ–‡ä»¶è¿ç§»æ¸…å•

| åŸä½ç½® | æ–°ä½ç½® |
|--------|--------|
| `services/embedding-service.js` | `modules/rag/services/embedding-service.ts` |
| `services/hybrid-retrieval.js` | `modules/rag/services/hybrid-retrieval.ts` |
| `scripts/rag/init-database.js` | `modules/rag/scripts/init-database.ts` |
| `scripts/rag/view-database.js` | `modules/rag/scripts/view-database.ts` |
| `data/rag-database.db` | `modules/rag/data/rag-database.db` |

#### 4.2 TypeScript åŒ–

- æ·»åŠ ç±»å‹å®šä¹‰
- ä½¿ç”¨ `better-sqlite3` çš„ç±»å‹

**éªŒè¯ç‚¹**ï¼š
- [ ] `node modules/rag/scripts/init-database.ts` æˆåŠŸ
- [ ] æ£€ç´¢æµ‹è¯•é€šè¿‡

---

### é˜¶æ®µ 5ï¼šé—¨æˆ·é›†æˆï¼ˆé¢„è®¡ 2 å°æ—¶ï¼‰

**ç›®æ ‡**ï¼šä¸»é—¨æˆ·å¼•å…¥å„æ¨¡å—ï¼Œä½¿ç”¨ç»Ÿä¸€ä¸»é¢˜

#### 5.1 é…ç½® Tailwind

```typescript
// portals/main/tailwind.config.ts
import pipBoyPreset from '@packages/pip-boy-theme/tailwind-preset'
import pipBoyCrtPlugin from '@packages/pip-boy-theme/crt-plugin'

export default {
  presets: [pipBoyPreset],
  plugins: [pipBoyCrtPlugin],
  content: [
    './src/**/*.{ts,tsx}',
    '../../packages/pip-boy-theme/components/**/*.tsx',
    '../../modules/*/frontend/src/**/*.tsx',
  ],
}
```

#### 5.2 è·¯ç”±é…ç½®

```typescript
// portals/main/src/App.tsx
import { BrowserRouter, Routes, Route } from 'react-router-dom'
import { MainMenu } from './pages/MainMenu'
import { LogViewerPage } from './pages/LogViewerPage'
import { ProfilePage } from './pages/ProfilePage'

function App() {
  return (
    <BrowserRouter>
      <CRTScreen>
        <Routes>
          <Route path="/" element={<MainMenu />} />
          <Route path="/log-viewer/*" element={<LogViewerPage />} />
          <Route path="/profile/*" element={<ProfilePage />} />
        </Routes>
      </CRTScreen>
    </BrowserRouter>
  )
}
```

#### 5.3 åå‘ä»£ç†æ›´æ–°

```typescript
// portals/main/vite.config.ts
export default defineConfig({
  server: {
    proxy: {
      '/api/logs': 'http://localhost:55555',
      '/api/profile': 'http://localhost:3002',
    }
  }
})
```

**éªŒè¯ç‚¹**ï¼š
- [ ] ä¸»èœå•æ˜¾ç¤ºæ­£å¸¸
- [ ] å­æ¨¡å—è·¯ç”±è·³è½¬æ­£å¸¸
- [ ] API ä»£ç†æ­£å¸¸
- [ ] Pip-Boy æ•ˆæœå®Œæ•´

---

### é˜¶æ®µ 6ï¼šæ¸…ç†ä¸æµ‹è¯•ï¼ˆé¢„è®¡ 1-2 å°æ—¶ï¼‰

#### 6.1 åˆ é™¤æ—§ç›®å½•

```bash
# ç¡®è®¤è¿ç§»å®Œæˆååˆ é™¤
rm -rf scripts/viewers/
rm -rf scripts/rag/
rm -rf scripts/profile/
rm -rf services/embedding-service.js
rm -rf services/hybrid-retrieval.js
rm -rf services/profile/
rm -rf viewers/log-viewer/
rm -rf viewers/user-profile/
rm -rf viewers/pip-boy-theme/    # å·² Tailwind åŒ–
rm -rf viewers/rag-memory/
```

#### 6.2 æµ‹è¯•æ–‡ä»¶é‡ç»„

```bash
# ç§»åŠ¨æµ‹è¯•æ–‡ä»¶
mv tests/test-retrieval.js tests/rag/
mv tests/test-model-selection.js tests/rag/
mv tests/Test-VoiceNotification.ps1 tests/voice/
mv tests/Test-Integration.ps1 tests/voice/
mv tests/Test-PlaySound.ps1 tests/voice/
mv tests/Test-ErrorMonitor.ps1 tests/voice/
```

#### 6.3 æ›´æ–°æµ‹è¯•æ–‡ä»¶è·¯å¾„

æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ä¸­çš„ `require`/`import` è·¯å¾„éœ€è¦æ›´æ–°ã€‚

#### 6.4 æ›´æ–° CLAUDE.md

æ·»åŠ æ–°æ¶æ„è¯´æ˜ã€ä¸»é¢˜ä½¿ç”¨è§„èŒƒã€‚

**éªŒè¯ç‚¹**ï¼š
- [ ] æ‰€æœ‰æ—§ç›®å½•å·²åˆ é™¤
- [ ] æµ‹è¯•å¯è¿è¡Œï¼ˆè·¯å¾„æ­£ç¡®ï¼‰
- [ ] Git æ— æœªè·Ÿè¸ªçš„é—ç•™æ–‡ä»¶

---

## å››ã€pnpm Workspace é…ç½®

### æ ¹ç›®å½• package.json

```json
{
  "name": "voice-notification-project",
  "private": true,
  "scripts": {
    "dev": "pnpm -r --parallel dev",
    "build": "pnpm -r build",
    "test:rag": "node tests/rag/test-retrieval.js",
    "test:voice": "pwsh tests/voice/Test-VoiceNotification.ps1"
  },
  "devDependencies": {
    "typescript": "^5.3.0"
  }
}
```

### pnpm-workspace.yaml

```yaml
packages:
  - 'modules/*'
  - 'modules/*/frontend'
  - 'modules/*/backend'
  - 'packages/*'
  - 'portals/*'
```

### å„æ¨¡å— package.json å‘½å

| æ¨¡å— | name |
|------|------|
| pip-boy-theme | `@packages/pip-boy-theme` |
| log-viewer/frontend | `@modules/log-viewer-frontend` |
| log-viewer/backend | `@modules/log-viewer-backend` |
| profile/frontend | `@modules/profile-frontend` |
| profile/backend | `@modules/profile-backend` |
| rag | `@modules/rag` |
| main portal | `@portals/main` |

---

## äº”ã€è·¯å¾„å˜æ›´æ€»è¡¨

### æ•°æ®åº“è·¯å¾„

| åŸè·¯å¾„ | æ–°è·¯å¾„ | ä½¿ç”¨è€… |
|--------|--------|--------|
| `data/memory.db` | `data/voice-notification.db` | è¯­éŸ³é€šçŸ¥ç³»ç»Ÿ |
| `data/rag-database.db` | `modules/rag/data/rag-database.db` | RAG æ¨¡å— |
| `data/profile/profile.db` | `modules/profile/data/profile.db` | Profile æ¨¡å— |

### æœåŠ¡è·¯å¾„

| åŸè·¯å¾„ | æ–°è·¯å¾„ |
|--------|--------|
| `services/embedding-service.js` | `modules/rag/services/embedding-service.ts` |
| `services/hybrid-retrieval.js` | `modules/rag/services/hybrid-retrieval.ts` |
| `services/profile/ollama-service.js` | `modules/profile/services/ollama-service.ts` |

### å‰ç«¯è·¯å¾„

| åŸè·¯å¾„ | æ–°è·¯å¾„ |
|--------|--------|
| `viewers/log-viewer/` | `modules/log-viewer/frontend/` |
| `viewers/user-profile/` | `modules/profile/frontend/` |
| `viewers/pip-boy-theme/` | `packages/pip-boy-theme/` |

### è„šæœ¬è·¯å¾„

| åŸè·¯å¾„ | æ–°è·¯å¾„ |
|--------|--------|
| `scripts/profile/*` | `modules/profile/backend/` |
| `scripts/rag/*` | `modules/rag/scripts/` |
| `scripts/viewers/log-viewers/node-server/` | `modules/log-viewer/backend/` |

---

## å…­ã€é£é™©ä¸æ³¨æ„äº‹é¡¹

### é«˜é£é™©é¡¹

1. **pip-boy-theme æ•ˆæœè¿˜åŸ**
   - é£é™©ï¼šTailwind åŒ–è¿‡ç¨‹ä¸­ä¸¢å¤±è§†è§‰ç»†èŠ‚
   - å¯¹ç­–ï¼šæ¯ä¸ªç»„ä»¶å®Œæˆåæˆªå›¾å¯¹æ¯”ï¼Œç¡®ä¿ 100% è¿˜åŸ

2. **æ•°æ®åº“è·¯å¾„å˜æ›´**
   - é£é™©ï¼šæœåŠ¡å¯åŠ¨æ—¶æ‰¾ä¸åˆ°æ•°æ®åº“
   - å¯¹ç­–ï¼šä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶ç®¡ç†è·¯å¾„ï¼Œè¿ç§»åç«‹å³æµ‹è¯•

3. **node_modules åˆå¹¶**
   - é£é™©ï¼šä¾èµ–ç‰ˆæœ¬å†²çª
   - å¯¹ç­–ï¼šä¼˜å…ˆä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆï¼Œä½¿ç”¨ `pnpm overrides` è§£å†³å†²çª

### ä¸­é£é™©é¡¹

4. **æµ‹è¯•æ–‡ä»¶è·¯å¾„**
   - é£é™©ï¼šæµ‹è¯•æ— æ³•è¿è¡Œ
   - å¯¹ç­–ï¼šé˜¶æ®µ 6 ä¸“é—¨å¤„ç†ï¼Œé€ä¸ªéªŒè¯

5. **React åŒ–è¿‡ç¨‹ä¸­é—æ¼åŠŸèƒ½**
   - é£é™©ï¼šæŸäº› JS é€»è¾‘æœªè¢«è½¬æ¢
   - å¯¹ç­–ï¼šåŸæ–‡ä»¶æ ‡æ³¨ `// TODO: å·²è¿ç§»` æˆ– `// TODO: å¾…è¿ç§»`

### ä½é£é™©é¡¹

6. **Git å†å²**
   - ä½¿ç”¨ `git mv` ä¿ç•™å†å²
   - å¤§è§„æ¨¡é‡æ„åæäº¤æ¸…æ™°çš„ commit message

---

## ä¸ƒã€æ‰§è¡Œæ£€æŸ¥æ¸…å•

### é˜¶æ®µ 0 å®Œæˆæ£€æŸ¥ âœ…
- [x] å¤‡ä»½åˆ†æ”¯ `backup/pre-refactor` å·²åˆ›å»º
- [x] `scripts/viewers/shared/` å·²åˆ é™¤
- [x] `viewers/rag-memory/` å·²åˆ é™¤
- [x] `data/memory.db` å·²é‡å‘½åä¸º `data/voice-notification.db`
- [x] `modules/`ã€`packages/` ç›®å½•å·²åˆ›å»º
- [x] `pnpm-workspace.yaml` å·²é…ç½®
- [x] `pnpm install` æˆåŠŸ

### é˜¶æ®µ 1 å®Œæˆæ£€æŸ¥ âœ…
- [x] `packages/pip-boy-theme/tailwind-preset.js` å·²åˆ›å»º
- [x] `packages/pip-boy-theme/crt-plugin.js` å·²åˆ›å»º
- [x] æ‰€æœ‰ React ç»„ä»¶å·²åˆ›å»º
- [x] `useKeyboardNavigation` hook å·²åˆ›å»º
- [x] Demo é¡µé¢æ•ˆæœä¸åŸ pip-boy-theme 100% ä¸€è‡´

### é˜¶æ®µ 2 å®Œæˆæ£€æŸ¥ âœ…
- [x] `modules/log-viewer/` ç»“æ„å®Œæ•´
- [x] åç«¯ TypeScript æºç è¿ç§»
- [x] config.json è·¯å¾„æ›´æ–°
- [x] æ—¥å¿—æ•°æ®å·²å¤åˆ¶

### é˜¶æ®µ 3 å®Œæˆæ£€æŸ¥ âœ…
- [x] `modules/profile/` ç»“æ„å®Œæ•´
- [x] åç«¯ TypeScript åŒ–å®Œæˆ
- [x] ollama-service è¿ç§»
- [x] æ•°æ®åº“å·²å¤åˆ¶

### é˜¶æ®µ 4 å®Œæˆæ£€æŸ¥ âœ…
- [x] `modules/rag/` ç»“æ„å®Œæ•´
- [x] embedding-service è¿ç§»
- [x] hybrid-retrieval è¿ç§»
- [x] æ•°æ®åº“å·²å¤åˆ¶

### é˜¶æ®µ 5 å®Œæˆæ£€æŸ¥ âœ…
- [x] é—¨æˆ·æ·»åŠ  pip-boy-theme workspace ä¾èµ–
- [x] CSS é¢œè‰²æ›´æ–°ä¸ºåŸå§‹ pip-boy-theme é¢œè‰² (#4af626)
- [x] Pip-Boy æ•ˆæœå®Œæ•´æ˜¾ç¤º

### é˜¶æ®µ 6 å®Œæˆæ£€æŸ¥ ğŸ”„ è¿›è¡Œä¸­
- [ ] æ—§ç›®å½•å¾…æ¸…ç†ï¼ˆéœ€ç¡®è®¤åæ‰‹åŠ¨åˆ é™¤ï¼‰
- [ ] æµ‹è¯•æ–‡ä»¶é‡ç»„ï¼ˆå¾…å®Œæˆï¼‰
- [ ] CLAUDE.md å¾…æ›´æ–°
- [ ] Git æäº¤å¾…å®Œæˆ

---

## å…«ã€æ—¶é—´ä¼°ç®—

| é˜¶æ®µ | é¢„è®¡æ—¶é—´ | ä¾èµ– |
|------|----------|------|
| é˜¶æ®µ 0ï¼šå‡†å¤‡å·¥ä½œ | 1 å°æ—¶ | æ—  |
| é˜¶æ®µ 1ï¼špip-boy-theme | 3-4 å°æ—¶ | é˜¶æ®µ 0 |
| é˜¶æ®µ 2ï¼šlog-viewer | 2-3 å°æ—¶ | é˜¶æ®µ 1 |
| é˜¶æ®µ 3ï¼šprofile | 3-4 å°æ—¶ | é˜¶æ®µ 1 |
| é˜¶æ®µ 4ï¼šrag | 1-2 å°æ—¶ | é˜¶æ®µ 1 |
| é˜¶æ®µ 5ï¼šé—¨æˆ·é›†æˆ | 2 å°æ—¶ | é˜¶æ®µ 2, 3, 4 |
| é˜¶æ®µ 6ï¼šæ¸…ç†æµ‹è¯• | 1-2 å°æ—¶ | é˜¶æ®µ 5 |

**æ€»è®¡**ï¼šçº¦ 13-18 å°æ—¶ï¼ˆåˆ† 3-4 å¤©å®Œæˆï¼‰

---

## ä¹ã€åç»­ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

é‡æ„å®Œæˆåå¯è€ƒè™‘ï¼š

1. **æ·»åŠ  E2E æµ‹è¯•** - Playwright è‡ªåŠ¨åŒ–æµ‹è¯•
2. **CI/CD é…ç½®** - GitHub Actions è‡ªåŠ¨æ„å»º
3. **Docker åŒ–** - å®¹å™¨åŒ–éƒ¨ç½²
4. **æ–‡æ¡£ç«™ç‚¹** - ä½¿ç”¨ Storybook å±•ç¤ºç»„ä»¶

---

**æ–‡æ¡£ç‰ˆæœ¬**: 2.0
**æœ€åæ›´æ–°**: 2025-11-25
**æ‰§è¡ŒçŠ¶æ€**: âœ… æ ¸å¿ƒè¿ç§»å®Œæˆ

## åã€æ‰§è¡Œæ€»ç»“

### å·²å®Œæˆå·¥ä½œ

1. **pip-boy-theme Tailwind åŒ–**
   - åˆ›å»º `packages/pip-boy-theme/` å…±äº«åŒ…
   - Tailwind é¢„è®¾ + CRT æ’ä»¶ + React ç»„ä»¶
   - 100% ä¿ç•™åŸå§‹é¢œè‰² (#4af626)

2. **log-viewer æ¨¡å—èšåˆ**
   - åç«¯ TypeScript åŒ–å®Œæˆ
   - é…ç½®æ–‡ä»¶è·¯å¾„æ›´æ–°
   - æ•°æ®æ–‡ä»¶è¿ç§»

3. **profile æ¨¡å—èšåˆ**
   - åç«¯ TypeScript åŒ–å®Œæˆ
   - ollama-service è¿ç§»
   - æ•°æ®åº“è¿ç§»

4. **RAG æ¨¡å—èšåˆ**
   - æœåŠ¡ TypeScript åŒ–å®Œæˆ
   - æ•°æ®åº“è¿ç§»

5. **é—¨æˆ·é›†æˆ**
   - workspace ä¾èµ–é…ç½®
   - CSS é¢œè‰²æ›´æ–°

### å¾…æ¸…ç†é¡¹ï¼ˆéœ€æ‰‹åŠ¨ç¡®è®¤ï¼‰

æ—§ç›®å½•å¯åœ¨ç¡®è®¤æ–°æ¨¡å—æ­£å¸¸è¿è¡Œååˆ é™¤ï¼š
- `scripts/viewers/`
- `scripts/rag/`
- `scripts/profile/`
- `services/embedding-service.js`
- `services/hybrid-retrieval.js`
- `services/profile/`
- `viewers/log-viewer/`
- `viewers/user-profile/`
- `viewers/pip-boy-theme/`
