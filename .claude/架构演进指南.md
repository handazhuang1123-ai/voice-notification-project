# Voice Notification Project - æ¶æ„æ¼”è¿›æŒ‡å—

> **ç›®æ ‡è¯»è€…**: Claude AI åŠ©æ‰‹
>
> **ç”¨é€”**: è¯¦ç»†è¯´æ˜é¡¹ç›®ä»é˜¶æ®µ 1 åˆ°é˜¶æ®µ 5 çš„å®Œæ•´æ¼”è¿›è·¯å¾„
>
> **æ›´æ–°**: 2025-01-20

---

## ğŸ“‹ æ–‡æ¡£è¯´æ˜

æœ¬æ–‡æ¡£æ˜¯ `.claude/CLAUDE.md` çš„è¡¥å……æ–‡æ¡£ï¼ŒåŒ…å«é¡¹ç›®æ¶æ„çš„é•¿æœŸè§„åˆ’å’Œè¯¦ç»†å®æ–½æ­¥éª¤ã€‚

**ä½•æ—¶é˜…è¯»æ­¤æ–‡æ¡£**ï¼š
1. å£®çˆ¸è¯¢é—®"åç»­é˜¶æ®µæ€ä¹ˆåš"æ—¶
2. å½“å‰é˜¶æ®µå®Œæˆï¼Œå‡†å¤‡è¿›å…¥ä¸‹ä¸€é˜¶æ®µæ—¶
3. éœ€è¦å†³ç­–æ¶æ„å‡çº§æ—¶ï¼ˆä¾‹å¦‚ï¼šæ˜¯å¦å¼•å…¥ Reactã€æ˜¯å¦ç”¨ Drizzleï¼‰

---

## ğŸ¯ æ ¸å¿ƒå®šä½

æœ¬é¡¹ç›®æ˜¯**å¤šåŠŸèƒ½é›†æˆå®éªŒåœº**ï¼Œç›®æ ‡æ˜¯ï¼š
1. å®ç°ä¸ªäººæƒ³æ³•çš„å¤šæ–¹å‘ç»¼åˆï¼ˆåšå®¢ã€è¯­è¨€å­¦ä¹ å·¥å…·ã€RAG çŸ¥è¯†åº“ç­‰ï¼‰
2. é”»ç‚¼å¤§å‹é¡¹ç›®åŠŸèƒ½é›†æˆèƒ½åŠ›
3. ä¿æŒæ‰©å±•æ€§å’Œè¿ç§»çµæ´»æ€§

**è®¾è®¡å“²å­¦**ï¼šæ¯›å¯æˆ¿é€æ­¥è£…ä¿®ï¼Œè€Œéä¸€æ¬¡æ€§æ­å»ºå®Œæ•´æ¶æ„

---

## ğŸ“ˆ é˜¶æ®µæ¦‚è§ˆ

| é˜¶æ®µ | åç§° | æŠ€æœ¯æ ˆ | è§¦å‘æ¡ä»¶ | é¢„è®¡æ—¶é•¿ |
|------|------|--------|----------|----------|
| 0 | ç¯å¢ƒæ¸…ç†ä¸è§„åˆ’ | - | é¡¹ç›®å¯åŠ¨ | âœ… å·²å®Œæˆ |
| 1 | RAG åŸºç¡€è®¾æ–½ | Vanilla JS + better-sqlite3 | å½“å‰é˜¶æ®µ | 1-2 å¤© |
| 2 | ä¸»å…¥å£é—¨æˆ· | Vite + React + TypeScript | RAG å®Œæˆå | 1 å¤© |
| 3 | å…±äº«ç»„ä»¶åº“ | React ç»„ä»¶ | å‘ç°ä»£ç é‡å¤ | æŒ‰éœ€ |
| 4 | å®Œæ•´åç«¯æœåŠ¡ | Fastify + Drizzle | æ•°æ®éœ€æ±‚å¢åŠ  | 2-3 å¤© |
| 5 | ç»Ÿä¸€æŠ€æœ¯æ ˆ | å…¨é¢ React åŒ– | é¡¹ç›®æˆç†Ÿæ—¶ | 3-5 å¤© |

---

## ğŸ—ï¸ é˜¶æ®µè¯¦ç»†è¯´æ˜

### é˜¶æ®µ 0ï¼šç¯å¢ƒæ¸…ç†ä¸è§„åˆ’ï¼ˆå·²å®Œæˆï¼‰

**çŠ¶æ€**ï¼šâœ… å·²å®Œæˆ

**å®Œæˆå†…å®¹**ï¼š
```
âœ… æ¸…ç† PowerShell VectorMemory ç›¸å…³æ–‡ä»¶ï¼ˆ9ä¸ªæ–‡ä»¶ï¼‰
âœ… ç¡®å®šåŒæ•°æ®åº“æ–¹æ¡ˆï¼ˆmemory.db + rag-database.dbï¼‰
âœ… å®Œæˆ RAG ç³»ç»ŸæŠ€æœ¯æ–¹æ¡ˆè®¾è®¡
âœ… æ›´æ–° CLAUDE.md æ·»åŠ æ¶æ„æ¼”è¿›ç« èŠ‚
```

---

### é˜¶æ®µ 1ï¼šRAG åŸºç¡€è®¾æ–½æ­å»ºï¼ˆå½“å‰é˜¶æ®µï¼‰

**çŠ¶æ€**ï¼šğŸ”„ è¿›è¡Œä¸­

**ç›®æ ‡**ï¼šä¸ºæ—¥å¿—æŸ¥çœ‹å™¨é›†æˆä¸ªæ€§åŒ– RAG çŸ¥è¯†åº“

**æŠ€æœ¯æ ˆ**ï¼š
- å‰ç«¯ï¼šVanilla JavaScriptï¼ˆä¿æŒ log-viewer ç°æœ‰æŠ€æœ¯æ ˆï¼‰
- åç«¯ï¼šNode.js + Express + better-sqlite3ï¼ˆåŸç”Ÿ SQLï¼‰
- æ•°æ®åº“ï¼š`data/rag-database.db`ï¼ˆç‹¬ç«‹äº memory.dbï¼‰

**ç›®å½•ç»“æ„**ï¼š
```
voice-notification-project/
â”œâ”€â”€ viewers/
â”‚   â””â”€â”€ log-viewer/          # ç°æœ‰æ—¥å¿—æŸ¥çœ‹å™¨
â”œâ”€â”€ services/                # RAG æ ¸å¿ƒæœåŠ¡
â”‚   â”œâ”€â”€ embedding-service.js    # åµŒå…¥ç”ŸæˆæœåŠ¡
â”‚   â””â”€â”€ hybrid-retrieval.js     # æ··åˆæ£€ç´¢å¼•æ“
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-database.js        # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ test-retrieval.js       # æ£€ç´¢åŠŸèƒ½æµ‹è¯•
â””â”€â”€ data/
    â”œâ”€â”€ memory.db               # è¯­éŸ³é€šçŸ¥ç³»ç»Ÿæ•°æ®åº“
    â””â”€â”€ rag-database.db         # RAG ç³»ç»Ÿæ•°æ®åº“
```

**è¯¦ç»†å®æ–½æ­¥éª¤**ï¼šå‚è€ƒ `docs/RAGç³»ç»Ÿå®æ–½æ–¹æ¡ˆä¸è¿›åº¦è¿½è¸ª.md`

**å®Œæˆæ ‡å¿—**ï¼š
- âœ… Qwen3-embedding:0.6b æ¨¡å‹æˆåŠŸéƒ¨ç½²
- âœ… rag-database.db åˆ›å»ºå¹¶åˆå§‹åŒ–
- âœ… åµŒå…¥æœåŠ¡å’Œæ··åˆæ£€ç´¢å¼•æ“æ­£å¸¸å·¥ä½œ
- âœ… æµ‹è¯•è„šæœ¬å…¨éƒ¨é€šè¿‡

---

### é˜¶æ®µ 2ï¼šä¸»å…¥å£é—¨æˆ·æ­å»º

**è§¦å‘æ¡ä»¶**ï¼šRAG Phase 1-2 å®Œæˆåï¼Œéœ€è¦ä¸€ä¸ªç»Ÿä¸€çš„å¯¼èˆªå…¥å£

**ç›®æ ‡**ï¼šåˆ›å»ºä¸»å…¥å£é—¨æˆ·ï¼Œè¿æ¥å„ä¸ªç‹¬ç«‹åŠŸèƒ½æ¨¡å—

**æŠ€æœ¯æ ˆ**ï¼š
- å‰ç«¯ï¼šVite + React 18 + TypeScriptï¼ˆæ–°æ¶æ„çš„èµ·ç‚¹ï¼‰
- UI ç»„ä»¶ï¼šshadcn/ui
- è·¯ç”±ï¼šReact Router v6
- çŠ¶æ€ç®¡ç†ï¼šZustandï¼ˆå¦‚éœ€è¦ï¼‰

**ç›®å½•ç»“æ„**ï¼š
```
voice-notification-project/
â”œâ”€â”€ apps/                    # ğŸ†• ç‹¬ç«‹åº”ç”¨ç›®å½•
â”‚   â””â”€â”€ portal/             # ğŸ†• ä¸»å…¥å£é—¨æˆ·
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ main.tsx
â”‚       â”‚   â”œâ”€â”€ App.tsx
â”‚       â”‚   â”œâ”€â”€ pages/
â”‚       â”‚   â”‚   â””â”€â”€ Home.tsx      # å¯¼èˆªé¡µé¢
â”‚       â”‚   â””â”€â”€ components/
â”‚       â”‚       â”œâ”€â”€ Header.tsx    # é¡¶éƒ¨å¯¼èˆª
â”‚       â”‚       â””â”€â”€ NavCard.tsx   # å¯¼èˆªå¡ç‰‡
â”‚       â”œâ”€â”€ index.html
â”‚       â”œâ”€â”€ vite.config.ts
â”‚       â”œâ”€â”€ tsconfig.json
â”‚       â”œâ”€â”€ tailwind.config.js
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ viewers/                 # ç°æœ‰ç›®å½•ï¼ˆä¿æŒä¸å˜ï¼‰
â”‚   â””â”€â”€ log-viewer/
â”œâ”€â”€ services/                # ç°æœ‰ RAG æœåŠ¡
â”œâ”€â”€ pnpm-workspace.yaml     # ğŸ†• pnpm å·¥ä½œåŒºé…ç½®
â””â”€â”€ package.json            # ğŸ†• æ ¹ç›®å½• package.json
```

**å®æ–½æ­¥éª¤**ï¼š

1. **å®‰è£… pnpm**ï¼ˆå¦‚æœªå®‰è£…ï¼‰
```bash
npm install -g pnpm
```

2. **åˆ›å»ºå·¥ä½œåŒºé…ç½®**
```yaml
# pnpm-workspace.yaml
packages:
  - 'apps/*'
  - 'packages/*'
```

3. **åˆ›å»º Portal åº”ç”¨**
```bash
cd apps
pnpm create vite portal --template react-ts
cd portal
pnpm install
```

4. **é…ç½® Tailwind CSS**
```bash
pnpm add -D tailwindcss postcss autoprefixer
pnpm dlx tailwindcss init -p
```

5. **å®‰è£… shadcn/ui**
```bash
pnpm dlx shadcn-ui@latest init
pnpm dlx shadcn-ui@latest add button card
```

6. **å®ç°å¯¼èˆªé¡µé¢**
```tsx
// src/pages/Home.tsx
import { Card } from '@/components/ui/card'
import { Button } from '@/components/ui/button'

export function Home() {
  return (
    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-slate-800 p-8">
      <h1 className="text-4xl font-bold text-white mb-8">
        å£®çˆ¸çš„å·¥å…·ç®±
      </h1>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* æœ¬åœ°å·¥å…· */}
        <Card className="p-6">
          <h2 className="text-2xl font-semibold mb-4">ğŸ”’ æœ¬åœ°å·¥å…·</h2>
          <div className="space-y-2">
            <Button asChild className="w-full">
              <a href="http://localhost:3001" target="_blank">
                æ—¥å¿—æŸ¥çœ‹å™¨
              </a>
            </Button>
          </div>
        </Card>

        {/* å…¬å¼€ä½œå“ï¼ˆæœªæ¥ï¼‰ */}
        <Card className="p-6 opacity-50">
          <h2 className="text-2xl font-semibold mb-4">ğŸŒ å…¬å¼€ä½œå“</h2>
          <p className="text-gray-500">å³å°†æ¨å‡º...</p>
        </Card>
      </div>
    </div>
  )
}
```

**ğŸ“ æ•™å­¦æ—¶æœº**ï¼š
å®Œæˆåï¼ŒClaude ä¼šå‘Šè¯‰å£®çˆ¸ï¼š
> "æˆ‘ä»¬åˆ›å»ºäº†ç¬¬ä¸€ä¸ª React åº”ç”¨ `apps/portal`ã€‚è¿™ä¸ªç›®å½•ç»“æ„æ˜¯ Monorepo çš„å¼€å§‹ã€‚
>
> **æ³¨æ„è¿™ä¸ªç»“æ„**ï¼š
> - `apps/` ç›®å½•ç”¨äºå­˜æ”¾ç‹¬ç«‹çš„åº”ç”¨ï¼ˆportalã€blogã€language-tool ç­‰ï¼‰
> - æ¯ä¸ªåº”ç”¨æœ‰è‡ªå·±çš„ package.jsonï¼Œå¯ä»¥ç‹¬ç«‹è¿è¡Œ
> - pnpm-workspace.yaml è®©å®ƒä»¬å…±äº«ä¾èµ–ï¼ŒèŠ‚çœç©ºé—´
>
> **æœªæ¥æ‰©å±•**ï¼š
> - æ·»åŠ åšå®¢ï¼šåˆ›å»º `apps/blog/`
> - æ·»åŠ è¯­è¨€å·¥å…·ï¼šåˆ›å»º `apps/language-tool/`
> - æ‰€æœ‰åº”ç”¨éƒ½ä¼šæ˜¾ç¤ºåœ¨è¿™ä¸ªå¯¼èˆªé¡µé¢ä¸Š"

**å®Œæˆæ ‡å¿—**ï¼š
- âœ… Portal åº”ç”¨èƒ½åœ¨ localhost:3000 è¿è¡Œ
- âœ… èƒ½çœ‹åˆ°å¯¼èˆªé¡µé¢
- âœ… ç‚¹å‡»"æ—¥å¿—æŸ¥çœ‹å™¨"èƒ½è·³è½¬åˆ° localhost:3001

---

### é˜¶æ®µ 3ï¼šå…±äº«ç»„ä»¶åº“

**è§¦å‘æ¡ä»¶**ï¼šå½“å‘ç°å¤šä¸ªåº”ç”¨éœ€è¦å¤ç”¨ UI ç»„ä»¶æ—¶ï¼ˆä¾‹å¦‚ï¼šHeaderã€Buttonã€Cardï¼‰

**ç›®æ ‡**ï¼šæå–å…±äº«ç»„ä»¶ï¼Œé¿å…ä»£ç é‡å¤

**å…¸å‹åœºæ™¯**ï¼š
```
å£®çˆ¸ï¼š"æˆ‘æƒ³ç»™ portal å’Œ blog éƒ½åŠ ä¸€ä¸ªç»Ÿä¸€çš„ Header"
Claudeï¼š"å‘ç°éœ€è¦å…±äº«ç»„ä»¶ï¼æˆ‘å»ºè®®åˆ›å»º packages/ui æ¥å­˜æ”¾é€šç”¨ç»„ä»¶ã€‚"
```

**ç›®å½•ç»“æ„**ï¼š
```
voice-notification-project/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ portal/              # å¤ç”¨ packages/ui
â”‚   â””â”€â”€ blog/                # ğŸ†• å¤ç”¨ packages/ui
â”œâ”€â”€ packages/                # ğŸ†• å…±äº«ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ ui/                  # ğŸ†• UI ç»„ä»¶åº“
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ card.tsx
â”‚   â”‚   â”‚   â”œâ”€â”€ header.tsx
â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â”œâ”€â”€ tsconfig.json
â”‚   â”‚   â””â”€â”€ tailwind.config.js
â”‚   â”œâ”€â”€ utils/               # ğŸ†• å·¥å…·å‡½æ•°ï¼ˆæœªæ¥ï¼‰
â”‚   â””â”€â”€ types/               # ğŸ†• TypeScript ç±»å‹ï¼ˆæœªæ¥ï¼‰
â””â”€â”€ viewers/
    â””â”€â”€ log-viewer/          # ä¿æŒ Vanilla JS
```

**å®æ–½æ­¥éª¤**ï¼š

1. **åˆ›å»ºç»„ä»¶åº“åŒ…**
```bash
mkdir -p packages/ui/src
cd packages/ui
pnpm init
```

2. **é…ç½® package.json**
```json
{
  "name": "@voice-notification/ui",
  "version": "0.0.1",
  "main": "src/index.ts",
  "types": "src/index.ts",
  "dependencies": {
    "react": "^18.2.0"
  },
  "peerDependencies": {
    "react": "^18.2.0"
  }
}
```

3. **æå–å…±äº«ç»„ä»¶**
```tsx
// packages/ui/src/header.tsx
export function Header({ title }: { title: string }) {
  return (
    <header className="bg-slate-800 p-4">
      <h1 className="text-2xl text-white">{title}</h1>
    </header>
  )
}

// packages/ui/src/index.ts
export { Header } from './header'
export { Button } from './button'
export { Card } from './card'
```

4. **åœ¨åº”ç”¨ä¸­ä½¿ç”¨**
```tsx
// apps/portal/src/App.tsx
import { Header } from '@voice-notification/ui'

export function App() {
  return <Header title="å£®çˆ¸çš„å·¥å…·ç®±" />
}
```

**ğŸ“ æ•™å­¦æ—¶æœº**ï¼š
å®Œæˆåï¼ŒClaude ä¼šå‘Šè¯‰å£®çˆ¸ï¼š
> "å…±äº«ç»„ä»¶åº“åˆ›å»ºå®Œæˆï¼
>
> **ä»€ä¹ˆæ—¶å€™éœ€è¦æå–å…±äº«ç»„ä»¶ï¼Ÿ**
> 1. åŒä¸€ä¸ªç»„ä»¶åœ¨ 2 ä¸ªä»¥ä¸Šçš„åº”ç”¨ä¸­ä½¿ç”¨
> 2. ç»„ä»¶é€»è¾‘ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸ä¾èµ–ç‰¹å®šåº”ç”¨çš„çŠ¶æ€
> 3. ç»„ä»¶æœ‰æ˜ç¡®çš„ API è¾¹ç•Œï¼ˆprops å®šä¹‰æ¸…æ™°ï¼‰
>
> **Monorepo çš„æ ¸å¿ƒä»·å€¼**ï¼š
> - ä¸€å¤„ä¿®æ”¹ï¼Œå¤šå¤„ç”Ÿæ•ˆ
> - ç»Ÿä¸€çš„è®¾è®¡é£æ ¼
> - å‡å°‘ä»£ç é‡å¤
>
> **ç°åœ¨çš„æ”¹åŠ¨**ï¼š
> - ä¿®æ”¹ `packages/ui/src/header.tsx`
> - portal å’Œ blog ä¼šè‡ªåŠ¨ä½¿ç”¨æ–°ç‰ˆæœ¬ï¼ˆæ— éœ€å¤åˆ¶ç²˜è´´ï¼‰"

**å®Œæˆæ ‡å¿—**ï¼š
- âœ… packages/ui åˆ›å»ºæˆåŠŸ
- âœ… è‡³å°‘ 2 ä¸ªåº”ç”¨å¤ç”¨äº†å…±äº«ç»„ä»¶
- âœ… ä¿®æ”¹å…±äº«ç»„ä»¶åï¼Œæ‰€æœ‰åº”ç”¨åŒæ­¥æ›´æ–°

---

### é˜¶æ®µ 4ï¼šå®Œæ•´åç«¯æœåŠ¡

**è§¦å‘æ¡ä»¶**ï¼šå½“å¤šä¸ªåº”ç”¨éœ€è¦ç»Ÿä¸€çš„ API å’Œæ•°æ®åº“æ—¶

**å…¸å‹åœºæ™¯**ï¼š
```
å£®çˆ¸ï¼š"æˆ‘æƒ³æ·»åŠ åšå®¢åŠŸèƒ½ï¼Œéœ€è¦å­˜å‚¨æ–‡ç« æ•°æ®"
Claudeï¼š"æ•°æ®å˜å¤šäº†ï¼å»ºè®®åˆ›å»ºç»Ÿä¸€çš„åç«¯æœåŠ¡ï¼Œä½¿ç”¨ Fastify + Drizzleã€‚"
```

**ç›®æ ‡**ï¼šæ­å»ºå®Œæ•´çš„åç«¯æœåŠ¡ï¼Œç»Ÿä¸€æ•°æ®ç®¡ç†

**æŠ€æœ¯æ ˆ**ï¼š
- Web æ¡†æ¶ï¼šFastifyï¼ˆæ›¿ä»£ Expressï¼‰
- ORMï¼šDrizzleï¼ˆæ›¿ä»£åŸç”Ÿ SQLï¼‰
- æ•°æ®åº“ï¼šSQLiteï¼ˆç»Ÿä¸€ç®¡ç†å¤šä¸ªåŠŸèƒ½çš„æ•°æ®ï¼‰

**ç›®å½•ç»“æ„**ï¼š
```
voice-notification-project/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ portal/
â”‚   â”œâ”€â”€ blog/
â”‚   â””â”€â”€ language-tool/       # ğŸ†• è¯­è¨€å­¦ä¹ å·¥å…·
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ utils/               # ğŸ†• å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ types/               # ğŸ†• TypeScript ç±»å‹
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api-gateway/         # ğŸ†• ç»Ÿä¸€ API ç½‘å…³ï¼ˆFastifyï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ blog.ts
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ language.ts
â”‚   â”‚   â”‚   â””â”€â”€ plugins/
â”‚   â”‚   â”œâ”€â”€ package.json
â”‚   â”‚   â””â”€â”€ tsconfig.json
â”‚   â”œâ”€â”€ database/            # ğŸ†• æ•°æ®åº“æœåŠ¡ï¼ˆDrizzleï¼‰
â”‚   â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ migrations/
â”‚   â”‚   â”‚   â””â”€â”€ client.ts
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â”œâ”€â”€ embedding-service.js # ä¿ç•™ï¼ˆRAG ä¸“ç”¨ï¼‰
â”‚   â””â”€â”€ hybrid-retrieval.js  # ä¿ç•™ï¼ˆRAG ä¸“ç”¨ï¼‰
â””â”€â”€ data/
    â”œâ”€â”€ memory.db
    â”œâ”€â”€ rag-database.db
    â””â”€â”€ main.db              # ğŸ†• ä¸»æ•°æ®åº“ï¼ˆåšå®¢ã€è¯­è¨€å·¥å…·ç­‰ï¼‰
```

**å®æ–½æ­¥éª¤**ï¼š

1. **åˆ›å»ºæ•°æ®åº“æœåŠ¡**
```bash
mkdir -p services/database/src
cd services/database
pnpm init
pnpm add drizzle-orm better-sqlite3
pnpm add -D drizzle-kit @types/better-sqlite3
```

2. **å®šä¹‰ Schema**
```typescript
// services/database/src/schema.ts
import { sqliteTable, text, integer } from 'drizzle-orm/sqlite-core'

export const posts = sqliteTable('posts', {
  id: integer('id').primaryKey({ autoIncrement: true }),
  title: text('title').notNull(),
  content: text('content').notNull(),
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull()
})

export const vocabulary = sqliteTable('vocabulary', {
  id: integer('id').primaryKey({ autoIncrement: true }),
  word: text('word').notNull(),
  translation: text('translation').notNull(),
  createdAt: integer('created_at', { mode: 'timestamp' }).notNull()
})
```

3. **åˆ›å»º Drizzle å®¢æˆ·ç«¯**
```typescript
// services/database/src/client.ts
import { drizzle } from 'drizzle-orm/better-sqlite3'
import Database from 'better-sqlite3'
import * as schema from './schema'

const sqlite = new Database('data/main.db')
export const db = drizzle(sqlite, { schema })
```

4. **åˆ›å»º API ç½‘å…³**
```bash
mkdir -p services/api-gateway/src
cd services/api-gateway
pnpm init
pnpm add fastify @fastify/cors
```

5. **å®ç° API è·¯ç”±**
```typescript
// services/api-gateway/src/index.ts
import Fastify from 'fastify'
import cors from '@fastify/cors'

const fastify = Fastify({ logger: true })

fastify.register(cors)

// åšå®¢è·¯ç”±
fastify.get('/api/posts', async (request, reply) => {
  const { db } = await import('../../database/src/client')
  const { posts } = await import('../../database/src/schema')

  const allPosts = await db.select().from(posts)
  return allPosts
})

fastify.listen({ port: 3100 }, (err) => {
  if (err) throw err
  console.log('API Gateway running on http://localhost:3100')
})
```

**ğŸ“ æ•™å­¦æ—¶æœº**ï¼š
å®Œæˆåï¼ŒClaude ä¼šå‘Šè¯‰å£®çˆ¸ï¼š
> "å®Œæ•´åç«¯æœåŠ¡æ­å»ºå®Œæˆï¼
>
> **ä¸ºä»€ä¹ˆä» better-sqlite3 å‡çº§åˆ° Drizzleï¼Ÿ**
>
> **ä¹‹å‰ï¼ˆRAG ç³»ç»Ÿï¼‰**ï¼š
> ```javascript
> const stmt = db.prepare('INSERT INTO knowledge_base (content, embedding) VALUES (?, ?)')
> stmt.run(content, embedding)
> ```
> - æ‰‹å†™ SQL å­—ç¬¦ä¸²ï¼Œå®¹æ˜“å‡ºé”™
> - æ²¡æœ‰ç±»å‹æ£€æŸ¥
> - å­—æ®µæ”¹åè¦å…¨å±€æœç´¢æ›¿æ¢
>
> **ç°åœ¨ï¼ˆDrizzleï¼‰**ï¼š
> ```typescript
> await db.insert(posts).values({ title, content })
> ```
> - TypeScript ç±»å‹æç¤ºï¼ˆå†™ä»£ç æ—¶æœ‰æ™ºèƒ½æç¤ºï¼‰
> - è‡ªåŠ¨è¿ç§»ï¼ˆSchema å˜æ›´è‡ªåŠ¨ç”Ÿæˆè¿ç§»è„šæœ¬ï¼‰
> - æ¥è¿‘åŸç”Ÿ SQL çš„æ€§èƒ½
> - æœªæ¥æƒ³æ¢ PostgreSQLï¼Ÿæ”¹ä¸ªé…ç½®å³å¯
>
> **ä»€ä¹ˆæ—¶å€™éœ€è¦å‡çº§åˆ°å®Œæ•´åç«¯ï¼Ÿ**
> - æ•°æ®ç±»å‹è¶…è¿‡ 3 ç§ï¼ˆåšå®¢æ–‡ç« ã€è¯æ±‡ã€ç”¨æˆ·è®¾ç½®ç­‰ï¼‰
> - éœ€è¦å¤æ‚çš„å…³è”æŸ¥è¯¢ï¼ˆæ–‡ç«  + è¯„è®º + ä½œè€…ï¼‰
> - æ€§èƒ½è¦æ±‚é«˜ï¼ˆåˆ†é¡µã€ç´¢å¼•ä¼˜åŒ–ï¼‰
> - å¤šä¸ªåº”ç”¨å…±äº«æ•°æ®"

**å®Œæˆæ ‡å¿—**ï¼š
- âœ… Drizzle æ•°æ®åº“æœåŠ¡æ­£å¸¸å·¥ä½œ
- âœ… API Gateway èƒ½è¿”å›æ•°æ®
- âœ… è‡³å°‘ 1 ä¸ªåº”ç”¨é€šè¿‡ API è¯»å†™æ•°æ®
- âœ… æ•°æ®åº“è¿ç§»è„šæœ¬æ­£å¸¸æ‰§è¡Œ

---

### é˜¶æ®µ 5ï¼šç»Ÿä¸€æŠ€æœ¯æ ˆ

**è§¦å‘æ¡ä»¶**ï¼šé¡¹ç›®åŠŸèƒ½ç¨³å®šï¼Œå†³å®šé•¿æœŸç»´æŠ¤æ—¶

**å…¸å‹åœºæ™¯**ï¼š
```
å£®çˆ¸ï¼š"ç°åœ¨é¡¹ç›®å·²ç»å¾ˆæˆç†Ÿäº†ï¼Œä½† log-viewer è¿˜æ˜¯ Vanilla JSï¼Œç»´æŠ¤èµ·æ¥ä¸å¤ªæ–¹ä¾¿"
Claudeï¼š"ç¡®å®ï¼Œå»ºè®®å°† log-viewer è¿ç§»åˆ° Reactï¼Œç»Ÿä¸€æŠ€æœ¯æ ˆã€‚"
```

**ç›®æ ‡**ï¼šå°† log-viewer è¿ç§»åˆ° Reactï¼Œç»Ÿä¸€æŠ€æœ¯æ ˆ

**è¿ç§»å†…å®¹**ï¼š
1. `viewers/log-viewer/` â†’ `apps/log-viewer/`ï¼ˆReact é‡å†™ï¼‰
2. æ‰€æœ‰æ•°æ®åº“æ“ä½œç»Ÿä¸€ç”¨ Drizzle
3. æ‰€æœ‰ UI ç»„ä»¶å¤ç”¨ `packages/ui`
4. ç»Ÿä¸€çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹

**æœ€ç»ˆç›®å½•ç»“æ„**ï¼š
```
voice-notification-project/
â”œâ”€â”€ apps/                    # æ‰€æœ‰åº”ç”¨ç»Ÿä¸€ç”¨ React
â”‚   â”œâ”€â”€ portal/
â”‚   â”œâ”€â”€ blog/
â”‚   â”œâ”€â”€ language-tool/
â”‚   â””â”€â”€ log-viewer/          # ğŸ”„ è¿ç§»å®Œæˆ
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ ui/
â”‚   â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ types/
â”‚   â””â”€â”€ config/              # ESLint/TS å…±äº«é…ç½®
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ api-gateway/         # ç»Ÿä¸€ API
â”‚   â””â”€â”€ database/            # ç»Ÿä¸€æ•°æ®åº“
â””â”€â”€ data/
    â”œâ”€â”€ memory.db            # å¯èƒ½åºŸå¼ƒ
    â””â”€â”€ main.db              # ç»Ÿä¸€æ•°æ®åº“
```

**è¿ç§»æ­¥éª¤**ï¼š

1. **åˆ†æç°æœ‰ log-viewer åŠŸèƒ½**
```bash
# åˆ—å‡ºæ‰€æœ‰åŠŸèƒ½æ¨¡å—
- æ—¥å¿—è§£æï¼ˆlog-parser.jsï¼‰
- ä¼šè¯æ¸²æŸ“ï¼ˆsession-card.jsï¼‰
- è¯¦æƒ…é¢æ¿ï¼ˆdetail-panel.jsï¼‰
- å®æ—¶æ›´æ–°ï¼ˆlong-pollingï¼‰
```

2. **åˆ›å»º React ç‰ˆæœ¬**
```bash
cd apps
pnpm create vite log-viewer --template react-ts
```

3. **é€ä¸ªè¿ç§»åŠŸèƒ½æ¨¡å—**
```tsx
// apps/log-viewer/src/components/SessionCard.tsx
import { Card } from '@voice-notification/ui'

interface SessionCardProps {
  session: LogSession
}

export function SessionCard({ session }: SessionCardProps) {
  return (
    <Card className="session-card">
      {/* React ç‰ˆæœ¬çš„å®ç° */}
    </Card>
  )
}
```

4. **è¿ç§»æ•°æ®å±‚**
```typescript
// apps/log-viewer/src/api/logs.ts
import { useQuery } from '@tanstack/react-query'

export function useLogs() {
  return useQuery({
    queryKey: ['logs'],
    queryFn: async () => {
      const res = await fetch('http://localhost:3100/api/logs')
      return res.json()
    }
  })
}
```

5. **ä¿ç•™ Vanilla JS ç‰ˆæœ¬ä½œä¸ºå¤‡ä»½**
```bash
mv viewers/log-viewer viewers/log-viewer-legacy
```

**ğŸ“ æ•™å­¦æ—¶æœº**ï¼š
å®Œæˆåï¼ŒClaude ä¼šå‘Šè¯‰å£®çˆ¸ï¼š
> "æŠ€æœ¯æ ˆç»Ÿä¸€å®Œæˆï¼
>
> **è¿ç§»å‰åå¯¹æ¯”**ï¼š
>
> | ç»´åº¦ | Vanilla JS ç‰ˆæœ¬ | React ç‰ˆæœ¬ |
> |------|----------------|-----------|
> | çŠ¶æ€ç®¡ç† | æ‰‹åŠ¨ DOM æ“ä½œ | React state + hooks |
> | ç»„ä»¶å¤ç”¨ | å¤åˆ¶ç²˜è´´ | å¯¼å…¥å…±äº«ç»„ä»¶ |
> | ç±»å‹å®‰å…¨ | æ—  | TypeScript å…¨è¦†ç›– |
> | å¼€å‘ä½“éªŒ | æ‰‹å†™ HTML å­—ç¬¦ä¸² | JSX + çƒ­æ›´æ–° |
> | ç»´æŠ¤æˆæœ¬ | é«˜ | ä½ |
>
> **ç°åœ¨çš„ä¼˜åŠ¿**ï¼š
> - æ‰€æœ‰åº”ç”¨ç”¨åŒä¸€å¥—æŠ€æœ¯æ ˆï¼ˆReact + TypeScriptï¼‰
> - å…±äº«ç»„ä»¶åº“è®© UI é£æ ¼ç»Ÿä¸€
> - ç»Ÿä¸€çš„æ„å»ºæµç¨‹ï¼ˆpnpm buildï¼‰
> - æ–°åŠŸèƒ½å¼€å‘é€Ÿåº¦æ›´å¿«
>
> **æ³¨æ„**ï¼š
> - Vanilla JS ç‰ˆæœ¬ä¿ç•™åœ¨ viewers/log-viewer-legacy/
> - å¦‚æœ React ç‰ˆæœ¬æœ‰é—®é¢˜ï¼Œå¯ä»¥éšæ—¶å›é€€"

**å®Œæˆæ ‡å¿—**ï¼š
- âœ… React ç‰ˆæœ¬åŠŸèƒ½å®Œå…¨ç­‰åŒäº Vanilla JS ç‰ˆæœ¬
- âœ… æ‰€æœ‰åº”ç”¨ç»Ÿä¸€ç”¨ React + TypeScript
- âœ… æ‰€æœ‰æ•°æ®æ“ä½œç»Ÿä¸€ç”¨ Drizzle
- âœ… ç»Ÿä¸€çš„æ„å»ºå’Œéƒ¨ç½²æµç¨‹

---

## ğŸš€ éƒ¨ç½²ç­–ç•¥

### æœ¬åœ°è¿è¡Œé˜¶æ®µï¼ˆé˜¶æ®µ 1-3ï¼‰

**è¿è¡Œæ–¹å¼**ï¼š
```bash
# å¯åŠ¨æ—¥å¿—æŸ¥çœ‹å™¨
cd viewers/log-viewer
npm start
# è®¿é—® http://localhost:3001

# å¯åŠ¨ Portalï¼ˆé˜¶æ®µ 2+ï¼‰
cd apps/portal
pnpm dev
# è®¿é—® http://localhost:3000

# å¯åŠ¨ APIï¼ˆé˜¶æ®µ 4+ï¼‰
cd services/api-gateway
pnpm dev
# API è¿è¡Œåœ¨ http://localhost:3100
```

**å¼€å‘ä½“éªŒ**ï¼š
- æ‰€æœ‰æœåŠ¡åŒæ—¶è¿è¡Œ
- æ”¯æŒçƒ­æ›´æ–°
- æœ¬åœ°æ•°æ®åº“

---

### é€‰æ‹©æ€§å…¬ç½‘éƒ¨ç½²ï¼ˆé˜¶æ®µ 4+ï¼‰

**æ–¹æ¡ˆ**ï¼šç»Ÿä¸€ä»£ç åº“ï¼Œé€‰æ‹©æ€§éƒ¨ç½²

**æœ¬åœ°åŠŸèƒ½**ï¼ˆåŒ…å«éšç§æ•°æ®ï¼Œä¸éƒ¨ç½²ï¼‰ï¼š
- æ—¥å¿—æŸ¥çœ‹å™¨ï¼ˆHook æ—¥å¿—ï¼‰
- ä¸ªäººç¬”è®°
- RAG çŸ¥è¯†åº“

**å…¬ç½‘åŠŸèƒ½**ï¼ˆå¯åˆ†äº«ï¼Œéƒ¨ç½²åˆ° Vercel/Railwayï¼‰ï¼š
- åšå®¢
- è¯­è¨€å­¦ä¹ å·¥å…·

**å®ç°æ–¹å¼**ï¼š

1. **é…ç½®æ–‡ä»¶**
```typescript
// apps/portal/config.ts
export const config = {
  // æœ¬åœ°æœåŠ¡
  localServices: {
    logViewer: 'http://localhost:3001',  // ğŸ”’ ä»…æœ¬åœ°
    notes: 'http://localhost:3002',      // ğŸ”’ ä»…æœ¬åœ°
  },

  // å…¬ç½‘æœåŠ¡
  publicServices: {
    blog: process.env.NODE_ENV === 'production'
      ? 'https://blog.zhuangba.com'      // ğŸŒ å…¬ç½‘
      : 'http://localhost:3003',         // æœ¬åœ°å¼€å‘

    languageTool: process.env.NODE_ENV === 'production'
      ? 'https://lang.zhuangba.com'
      : 'http://localhost:3004',
  }
}
```

2. **Vercel éƒ¨ç½²é…ç½®**
```json
{
  "builds": [
    {
      "src": "apps/blog/package.json",
      "use": "@vercel/node"
    },
    {
      "src": "apps/language-tool/package.json",
      "use": "@vercel/node"
    }
  ],
  "routes": [
    {
      "src": "/blog/(.*)",
      "dest": "apps/blog/$1"
    },
    {
      "src": "/lang/(.*)",
      "dest": "apps/language-tool/$1"
    }
  ]
}
```

3. **ç¯å¢ƒå˜é‡é…ç½®**
```bash
# .env.production
DATABASE_URL=postgresql://... # å…¬ç½‘æ•°æ®åº“
NODE_ENV=production

# .env.local
DATABASE_URL=sqlite://data/main.db # æœ¬åœ°æ•°æ®åº“
NODE_ENV=development
```

4. **Portal å¯¼èˆªé¡µé¢é€‚é…**
```tsx
// apps/portal/src/pages/Home.tsx
import { config } from '../config'

export function Home() {
  const isProduction = process.env.NODE_ENV === 'production'

  return (
    <div className="grid grid-cols-2 gap-4">
      {/* æœ¬åœ°åŠŸèƒ½ï¼ˆç”Ÿäº§ç¯å¢ƒä¸æ˜¾ç¤ºï¼‰ */}
      {!isProduction && (
        <Card>
          <h3>ğŸ”’ æœ¬åœ°å·¥å…·</h3>
          <a href={config.localServices.logViewer}>æ—¥å¿—æŸ¥çœ‹å™¨</a>
        </Card>
      )}

      {/* å…¬ç½‘åŠŸèƒ½ï¼ˆå§‹ç»ˆæ˜¾ç¤ºï¼‰ */}
      <Card>
        <h3>ğŸŒ å…¬å¼€ä½œå“</h3>
        <a href={config.publicServices.blog}>æˆ‘çš„åšå®¢</a>
        <a href={config.publicServices.languageTool}>è¯­è¨€å­¦ä¹ </a>
      </Card>
    </div>
  )
}
```

**éƒ¨ç½²æµç¨‹**ï¼š
```bash
# 1. æœ¬åœ°æµ‹è¯•
pnpm build
pnpm preview

# 2. éƒ¨ç½²åšå®¢åˆ° Vercel
cd apps/blog
vercel deploy --prod

# 3. éƒ¨ç½²è¯­è¨€å·¥å…·åˆ° Railway
cd apps/language-tool
railway up
```

**æ•°æ®éš”ç¦»**ï¼š
- æœ¬åœ°æ•°æ®åº“ï¼š`data/local.db`ï¼ˆHook æ—¥å¿—ã€ä¸ªäººç¬”è®°ï¼‰
- å…¬ç½‘æ•°æ®åº“ï¼šPostgreSQL on Railwayï¼ˆåšå®¢æ–‡ç« ã€å…¬å¼€å†…å®¹ï¼‰

---

## ğŸ“ Claude æ•™å­¦èŒè´£

### ä½•æ—¶ä¸»åŠ¨æç¤º

1. **å‘ç°ä»£ç é‡å¤æ—¶**
```
å£®çˆ¸ï¼š"æˆ‘åœ¨ portal å’Œ blog é‡Œéƒ½å†™äº†ä¸€ä¸ª Header ç»„ä»¶"
Claudeï¼š"å‘ç°ä»£ç é‡å¤ï¼å»ºè®®åˆ›å»º packages/ui/header.tsx æ¥å®ç°å¤ç”¨ã€‚
è¿™å°±æ˜¯è¿›å…¥é˜¶æ®µ 3 çš„ä¿¡å·ã€‚æˆ‘å¯ä»¥å¸®ä½ æå–å…±äº«ç»„ä»¶å—ï¼Ÿ"
```

2. **æ•°æ®ç®¡ç†å˜å¤æ‚æ—¶**
```
å£®çˆ¸ï¼š"åšå®¢éœ€è¦å­˜å‚¨æ–‡ç« ã€è¯„è®ºã€æ ‡ç­¾..."
Claudeï¼š"æ•°æ®ç±»å‹å˜å¤šäº†ï¼å»ºè®®å¼•å…¥ Drizzle ORM æ¥ç®¡ç†è¿™äº›å¤æ‚çš„æ•°æ®å…³ç³»ã€‚
è¿™æ˜¯è¿›å…¥é˜¶æ®µ 4 çš„å¥½æ—¶æœºã€‚éœ€è¦æˆ‘å¸®ä½ æ­å»ºå®Œæ•´åç«¯å—ï¼Ÿ"
```

3. **åŠŸèƒ½ç¨³å®šéœ€è¦ç»Ÿä¸€æ—¶**
```
å£®çˆ¸ï¼š"é¡¹ç›®å·²ç»è¿è¡Œäº†å‡ ä¸ªæœˆï¼Œä½† log-viewer ç”¨ Vanilla JS ç»´æŠ¤èµ·æ¥æœ‰ç‚¹éº»çƒ¦"
Claudeï¼š"ç¡®å®ï¼Œç°åœ¨æ˜¯æ—¶å€™è€ƒè™‘æŠ€æœ¯æ ˆç»Ÿä¸€äº†ï¼ˆé˜¶æ®µ 5ï¼‰ã€‚
æˆ‘å¯ä»¥å¸®ä½ è§„åˆ’ log-viewer çš„ React è¿ç§»æ–¹æ¡ˆï¼Œä¿è¯åŠŸèƒ½ä¸ä¸¢å¤±ã€‚"
```

### åˆ›å»ºæ–°æ¨¡å—æ—¶çš„è¯´æ˜æ¨¡æ¿

```markdown
## ä¸ºä»€ä¹ˆåˆ›å»ºè¿™ä¸ªæ¨¡å—

**èƒŒæ™¯**ï¼š[æè¿°å½“å‰é‡åˆ°çš„é—®é¢˜]

**è§£å†³æ–¹æ¡ˆ**ï¼š[åˆ›å»º XXX æ¨¡å—]

**å¥½å¤„**ï¼š
1. [å…·ä½“å¥½å¤„ 1]
2. [å…·ä½“å¥½å¤„ 2]

**è¿™ä½“ç°äº† Monorepo çš„ä»·å€¼**ï¼š[è§£é‡Šæ¶æ„ä¼˜åŠ¿]

**ç°åœ¨çš„æ”¹åŠ¨**ï¼š
- åˆ›å»ºï¼š[æ–°æ–‡ä»¶åˆ—è¡¨]
- ä¿®æ”¹ï¼š[ä¿®æ”¹çš„æ–‡ä»¶]

**æœªæ¥çš„å½±å“**ï¼š[è¿™ä¸ªæ¨¡å—æœªæ¥å¦‚ä½•æ¼”è¿›]
```

### æ¶æ„å†³ç­–åŸåˆ™

1. **ä¸æå‰è®¾è®¡**
   - ä¸è¦åœ¨é˜¶æ®µ 1 å°±åˆ›å»º packages/ui
   - ä¸è¦åœ¨è¿˜æ²¡æœ‰å¤šä¸ªåº”ç”¨æ—¶å°±å¼•å…¥ Monorepo
   - ç­‰çœŸæ­£éœ€è¦æ—¶å†åˆ›å»º

2. **æ¸è¿›å¼å‡çº§**
   - RAG ç³»ç»Ÿä¿æŒ Vanilla JSï¼Œä¸å¼ºåˆ¶è¿ç§»
   - æ–°åŠŸèƒ½ç”¨æ–°æŠ€æœ¯ï¼Œæ—§åŠŸèƒ½ä¿æŒç¨³å®š
   - è¿ç§»æ—¶æœºç”±å£®çˆ¸å†³å®š

3. **ä¿æŒè¿ç§»çµæ´»æ€§**
   - é¿å…æ·±åº¦æ¡†æ¶ç»‘å®š
   - æ•°æ®åº“ Schema ä½¿ç”¨æ ‡å‡† SQL
   - API è®¾è®¡éµå¾ª RESTful è§„èŒƒ
   - é…ç½®ä¸ä»£ç åˆ†ç¦»

---

## ğŸ“ æ›´æ–°è®°å½•

### 2025-01-20
- åˆ›å»ºæ¶æ„æ¼”è¿›æŒ‡å—æ–‡æ¡£
- è¯¦ç»†è¯´æ˜ 5 ä¸ªé˜¶æ®µçš„å®æ–½æ­¥éª¤
- æ·»åŠ æ•™å­¦æ—¶æœºå’Œæç¤ºæ¨¡æ¿
- å®šä¹‰ Claude çš„æ•™å­¦èŒè´£

---

**ç»´æŠ¤è€…**: å£®çˆ¸ | **æ–‡æ¡£ç‰ˆæœ¬**: 1.0
